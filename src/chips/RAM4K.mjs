import { ChipDef } from '../components/ChipDef.mjs';

export const RAM4K = new ChipDef(`
CHIP RAM4K {
  IN load, address[12], in[16];
  OUT out[16];
  
  PARTS:
  DMux8Way(sel=address[0..2], in=load, a=la, b=lb, c=lc, d=ld, e=le, f=lf, g=lg, h=lh);
  RAM512(in=in, load=la, address=address[3..11], out=a);
  RAM512(in=in, load=lb, address=address[3..11], out=b);
  RAM512(in=in, load=lc, address=address[3..11], out=c);
  RAM512(in=in, load=ld, address=address[3..11], out=d);
  RAM512(in=in, load=le, address=address[3..11], out=e);
  RAM512(in=in, load=lf, address=address[3..11], out=f);
  RAM512(in=in, load=lg, address=address[3..11], out=g);
  RAM512(in=in, load=lh, address=address[3..11], out=h);
  Mux8Way16(sel=address[0..2], a=a, b=b, c=c, d=d, e=e, f=f, g=g, h=h, out=out);
}
`).test(`
| time |   in   |load |address |  out   |
| 0+   |      0 |  0  |     0  |      0 |
| 1    |      0 |  0  |     0  |      0 |
| 1+   |      0 |  1  |     0  |      0 |
| 2    |      0 |  1  |     0  |      0 |
| 2+   |   1111 |  0  |     0  |      0 |
| 3    |   1111 |  0  |     0  |      0 |
| 3+   |   1111 |  1  |  1111  |      0 |
| 4    |   1111 |  1  |  1111  |   1111 |
| 4+   |   1111 |  0  |     0  |      0 |
| 5    |   1111 |  0  |     0  |      0 |
| 5+   |   3513 |  0  |  3513  |      0 |
| 6    |   3513 |  0  |  3513  |      0 |
| 6+   |   3513 |  1  |  3513  |      0 |
| 7    |   3513 |  1  |  3513  |   3513 |
| 7+   |   3513 |  0  |  3513  |   3513 |
| 8    |   3513 |  0  |  3513  |   3513 |
| 8    |   3513 |  0  |  1111  |   1111 |
| 8+   |   4095 |  0  |  1111  |   1111 |
| 9    |   4095 |  0  |  1111  |   1111 |
| 9+   |   4095 |  1  |  4095  |      0 |
| 10   |   4095 |  1  |  4095  |   4095 |
| 10+  |   4095 |  0  |  4095  |   4095 |
| 11   |   4095 |  0  |  4095  |   4095 |
| 11   |   4095 |  0  |  3513  |   3513 |
| 11   |   4095 |  0  |  4095  |   4095 |
| 11+  |   4095 |  0  |  2728  |      0 |
| 12   |   4095 |  0  |  2728  |      0 |
| 12   |   4095 |  0  |  2729  |      0 |
| 12   |   4095 |  0  |  2730  |      0 |
| 12   |   4095 |  0  |  2731  |      0 |
| 12   |   4095 |  0  |  2732  |      0 |
| 12   |   4095 |  0  |  2733  |      0 |
| 12   |   4095 |  0  |  2734  |      0 |
| 12   |   4095 |  0  |  2735  |      0 |
| 12+  |  21845 |  1  |  2728  |      0 |
| 13   |  21845 |  1  |  2728  |  21845 |
| 13+  |  21845 |  1  |  2729  |      0 |
| 14   |  21845 |  1  |  2729  |  21845 |
| 14+  |  21845 |  1  |  2730  |      0 |
| 15   |  21845 |  1  |  2730  |  21845 |
| 15+  |  21845 |  1  |  2731  |      0 |
| 16   |  21845 |  1  |  2731  |  21845 |
| 16+  |  21845 |  1  |  2732  |      0 |
| 17   |  21845 |  1  |  2732  |  21845 |
| 17+  |  21845 |  1  |  2733  |      0 |
| 18   |  21845 |  1  |  2733  |  21845 |
| 18+  |  21845 |  1  |  2734  |      0 |
| 19   |  21845 |  1  |  2734  |  21845 |
| 19+  |  21845 |  1  |  2735  |      0 |
| 20   |  21845 |  1  |  2735  |  21845 |
| 20+  |  21845 |  0  |  2728  |  21845 |
| 21   |  21845 |  0  |  2728  |  21845 |
| 21   |  21845 |  0  |  2729  |  21845 |
| 21   |  21845 |  0  |  2730  |  21845 |
| 21   |  21845 |  0  |  2731  |  21845 |
| 21   |  21845 |  0  |  2732  |  21845 |
| 21   |  21845 |  0  |  2733  |  21845 |
| 21   |  21845 |  0  |  2734  |  21845 |
| 21   |  21845 |  0  |  2735  |  21845 |
| 21+  | -21846 |  1  |  2728  |  21845 |
| 22   | -21846 |  1  |  2728  | -21846 |
| 22+  | -21846 |  0  |  2728  | -21846 |
| 23   | -21846 |  0  |  2728  | -21846 |
| 23   | -21846 |  0  |  2729  |  21845 |
| 23   | -21846 |  0  |  2730  |  21845 |
| 23   | -21846 |  0  |  2731  |  21845 |
| 23   | -21846 |  0  |  2732  |  21845 |
| 23   | -21846 |  0  |  2733  |  21845 |
| 23   | -21846 |  0  |  2734  |  21845 |
| 23   | -21846 |  0  |  2735  |  21845 |
| 23+  |  21845 |  1  |  2728  | -21846 |
| 24   |  21845 |  1  |  2728  |  21845 |
| 24+  | -21846 |  1  |  2729  |  21845 |
| 25   | -21846 |  1  |  2729  | -21846 |
| 25+  | -21846 |  0  |  2728  |  21845 |
| 26   | -21846 |  0  |  2728  |  21845 |
| 26   | -21846 |  0  |  2729  | -21846 |
| 26   | -21846 |  0  |  2730  |  21845 |
| 26   | -21846 |  0  |  2731  |  21845 |
| 26   | -21846 |  0  |  2732  |  21845 |
| 26   | -21846 |  0  |  2733  |  21845 |
| 26   | -21846 |  0  |  2734  |  21845 |
| 26   | -21846 |  0  |  2735  |  21845 |
| 26+  |  21845 |  1  |  2729  | -21846 |
| 27   |  21845 |  1  |  2729  |  21845 |
| 27+  | -21846 |  1  |  2730  |  21845 |
| 28   | -21846 |  1  |  2730  | -21846 |
| 28+  | -21846 |  0  |  2728  |  21845 |
| 29   | -21846 |  0  |  2728  |  21845 |
| 29   | -21846 |  0  |  2729  |  21845 |
| 29   | -21846 |  0  |  2730  | -21846 |
| 29   | -21846 |  0  |  2731  |  21845 |
| 29   | -21846 |  0  |  2732  |  21845 |
| 29   | -21846 |  0  |  2733  |  21845 |
| 29   | -21846 |  0  |  2734  |  21845 |
| 29   | -21846 |  0  |  2735  |  21845 |
| 29+  |  21845 |  1  |  2730  | -21846 |
| 30   |  21845 |  1  |  2730  |  21845 |
| 30+  | -21846 |  1  |  2731  |  21845 |
| 31   | -21846 |  1  |  2731  | -21846 |
| 31+  | -21846 |  0  |  2728  |  21845 |
| 32   | -21846 |  0  |  2728  |  21845 |
| 32   | -21846 |  0  |  2729  |  21845 |
| 32   | -21846 |  0  |  2730  |  21845 |
| 32   | -21846 |  0  |  2731  | -21846 |
| 32   | -21846 |  0  |  2732  |  21845 |
| 32   | -21846 |  0  |  2733  |  21845 |
| 32   | -21846 |  0  |  2734  |  21845 |
| 32   | -21846 |  0  |  2735  |  21845 |
| 32+  |  21845 |  1  |  2731  | -21846 |
| 33   |  21845 |  1  |  2731  |  21845 |
| 33+  | -21846 |  1  |  2732  |  21845 |
| 34   | -21846 |  1  |  2732  | -21846 |
| 34+  | -21846 |  0  |  2728  |  21845 |
| 35   | -21846 |  0  |  2728  |  21845 |
| 35   | -21846 |  0  |  2729  |  21845 |
| 35   | -21846 |  0  |  2730  |  21845 |
| 35   | -21846 |  0  |  2731  |  21845 |
| 35   | -21846 |  0  |  2732  | -21846 |
| 35   | -21846 |  0  |  2733  |  21845 |
| 35   | -21846 |  0  |  2734  |  21845 |
| 35   | -21846 |  0  |  2735  |  21845 |
| 35+  |  21845 |  1  |  2732  | -21846 |
| 36   |  21845 |  1  |  2732  |  21845 |
| 36+  | -21846 |  1  |  2733  |  21845 |
| 37   | -21846 |  1  |  2733  | -21846 |
| 37+  | -21846 |  0  |  2728  |  21845 |
| 38   | -21846 |  0  |  2728  |  21845 |
| 38   | -21846 |  0  |  2729  |  21845 |
| 38   | -21846 |  0  |  2730  |  21845 |
| 38   | -21846 |  0  |  2731  |  21845 |
| 38   | -21846 |  0  |  2732  |  21845 |
| 38   | -21846 |  0  |  2733  | -21846 |
| 38   | -21846 |  0  |  2734  |  21845 |
| 38   | -21846 |  0  |  2735  |  21845 |
| 38+  |  21845 |  1  |  2733  | -21846 |
| 39   |  21845 |  1  |  2733  |  21845 |
| 39+  | -21846 |  1  |  2734  |  21845 |
| 40   | -21846 |  1  |  2734  | -21846 |
| 40+  | -21846 |  0  |  2728  |  21845 |
| 41   | -21846 |  0  |  2728  |  21845 |
| 41   | -21846 |  0  |  2729  |  21845 |
| 41   | -21846 |  0  |  2730  |  21845 |
| 41   | -21846 |  0  |  2731  |  21845 |
| 41   | -21846 |  0  |  2732  |  21845 |
| 41   | -21846 |  0  |  2733  |  21845 |
| 41   | -21846 |  0  |  2734  | -21846 |
| 41   | -21846 |  0  |  2735  |  21845 |
| 41+  |  21845 |  1  |  2734  | -21846 |
| 42   |  21845 |  1  |  2734  |  21845 |
| 42+  | -21846 |  1  |  2735  |  21845 |
| 43   | -21846 |  1  |  2735  | -21846 |
| 43+  | -21846 |  0  |  2728  |  21845 |
| 44   | -21846 |  0  |  2728  |  21845 |
| 44   | -21846 |  0  |  2729  |  21845 |
| 44   | -21846 |  0  |  2730  |  21845 |
| 44   | -21846 |  0  |  2731  |  21845 |
| 44   | -21846 |  0  |  2732  |  21845 |
| 44   | -21846 |  0  |  2733  |  21845 |
| 44   | -21846 |  0  |  2734  |  21845 |
| 44   | -21846 |  0  |  2735  | -21846 |
| 44+  |  21845 |  1  |  2735  | -21846 |
| 45   |  21845 |  1  |  2735  |  21845 |
| 45+  |  21845 |  0  |  2728  |  21845 |
| 46   |  21845 |  0  |  2728  |  21845 |
| 46   |  21845 |  0  |  2729  |  21845 |
| 46   |  21845 |  0  |  2730  |  21845 |
| 46   |  21845 |  0  |  2731  |  21845 |
| 46   |  21845 |  0  |  2732  |  21845 |
| 46   |  21845 |  0  |  2733  |  21845 |
| 46   |  21845 |  0  |  2734  |  21845 |
| 46   |  21845 |  0  |  2735  |  21845 |
| 46+  |  21845 |  0  |   341  |      0 |
| 47   |  21845 |  0  |   341  |      0 |
| 47   |  21845 |  0  |   853  |      0 |
| 47   |  21845 |  0  |  1365  |      0 |
| 47   |  21845 |  0  |  1877  |      0 |
| 47   |  21845 |  0  |  2389  |      0 |
| 47   |  21845 |  0  |  2901  |      0 |
| 47   |  21845 |  0  |  3413  |      0 |
| 47   |  21845 |  0  |  3925  |      0 |
| 47+  |  21845 |  1  |   341  |      0 |
| 48   |  21845 |  1  |   341  |  21845 |
| 48+  |  21845 |  1  |   853  |      0 |
| 49   |  21845 |  1  |   853  |  21845 |
| 49+  |  21845 |  1  |  1365  |      0 |
| 50   |  21845 |  1  |  1365  |  21845 |
| 50+  |  21845 |  1  |  1877  |      0 |
| 51   |  21845 |  1  |  1877  |  21845 |
| 51+  |  21845 |  1  |  2389  |      0 |
| 52   |  21845 |  1  |  2389  |  21845 |
| 52+  |  21845 |  1  |  2901  |      0 |
| 53   |  21845 |  1  |  2901  |  21845 |
| 53+  |  21845 |  1  |  3413  |      0 |
| 54   |  21845 |  1  |  3413  |  21845 |
| 54+  |  21845 |  1  |  3925  |      0 |
| 55   |  21845 |  1  |  3925  |  21845 |
| 55+  |  21845 |  0  |   341  |  21845 |
| 56   |  21845 |  0  |   341  |  21845 |
| 56   |  21845 |  0  |   853  |  21845 |
| 56   |  21845 |  0  |  1365  |  21845 |
| 56   |  21845 |  0  |  1877  |  21845 |
| 56   |  21845 |  0  |  2389  |  21845 |
| 56   |  21845 |  0  |  2901  |  21845 |
| 56   |  21845 |  0  |  3413  |  21845 |
| 56   |  21845 |  0  |  3925  |  21845 |
| 56+  | -21846 |  1  |   341  |  21845 |
| 57   | -21846 |  1  |   341  | -21846 |
| 57+  | -21846 |  0  |   341  | -21846 |
| 58   | -21846 |  0  |   341  | -21846 |
| 58   | -21846 |  0  |   853  |  21845 |
| 58   | -21846 |  0  |  1365  |  21845 |
| 58   | -21846 |  0  |  1877  |  21845 |
| 58   | -21846 |  0  |  2389  |  21845 |
| 58   | -21846 |  0  |  2901  |  21845 |
| 58   | -21846 |  0  |  3413  |  21845 |
| 58   | -21846 |  0  |  3925  |  21845 |
| 58+  |  21845 |  1  |   341  | -21846 |
| 59   |  21845 |  1  |   341  |  21845 |
| 59+  | -21846 |  1  |   853  |  21845 |
| 60   | -21846 |  1  |   853  | -21846 |
| 60+  | -21846 |  0  |   341  |  21845 |
| 61   | -21846 |  0  |   341  |  21845 |
| 61   | -21846 |  0  |   853  | -21846 |
| 61   | -21846 |  0  |  1365  |  21845 |
| 61   | -21846 |  0  |  1877  |  21845 |
| 61   | -21846 |  0  |  2389  |  21845 |
| 61   | -21846 |  0  |  2901  |  21845 |
| 61   | -21846 |  0  |  3413  |  21845 |
| 61   | -21846 |  0  |  3925  |  21845 |
| 61+  |  21845 |  1  |   853  | -21846 |
| 62   |  21845 |  1  |   853  |  21845 |
| 62+  | -21846 |  1  |  1365  |  21845 |
| 63   | -21846 |  1  |  1365  | -21846 |
| 63+  | -21846 |  0  |   341  |  21845 |
| 64   | -21846 |  0  |   341  |  21845 |
| 64   | -21846 |  0  |   853  |  21845 |
| 64   | -21846 |  0  |  1365  | -21846 |
| 64   | -21846 |  0  |  1877  |  21845 |
| 64   | -21846 |  0  |  2389  |  21845 |
| 64   | -21846 |  0  |  2901  |  21845 |
| 64   | -21846 |  0  |  3413  |  21845 |
| 64   | -21846 |  0  |  3925  |  21845 |
| 64+  |  21845 |  1  |  1365  | -21846 |
| 65   |  21845 |  1  |  1365  |  21845 |
| 65+  | -21846 |  1  |  1877  |  21845 |
| 66   | -21846 |  1  |  1877  | -21846 |
| 66+  | -21846 |  0  |   341  |  21845 |
| 67   | -21846 |  0  |   341  |  21845 |
| 67   | -21846 |  0  |   853  |  21845 |
| 67   | -21846 |  0  |  1365  |  21845 |
| 67   | -21846 |  0  |  1877  | -21846 |
| 67   | -21846 |  0  |  2389  |  21845 |
| 67   | -21846 |  0  |  2901  |  21845 |
| 67   | -21846 |  0  |  3413  |  21845 |
| 67   | -21846 |  0  |  3925  |  21845 |
| 67+  |  21845 |  1  |  1877  | -21846 |
| 68   |  21845 |  1  |  1877  |  21845 |
| 68+  | -21846 |  1  |  2389  |  21845 |
| 69   | -21846 |  1  |  2389  | -21846 |
| 69+  | -21846 |  0  |   341  |  21845 |
| 70   | -21846 |  0  |   341  |  21845 |
| 70   | -21846 |  0  |   853  |  21845 |
| 70   | -21846 |  0  |  1365  |  21845 |
| 70   | -21846 |  0  |  1877  |  21845 |
| 70   | -21846 |  0  |  2389  | -21846 |
| 70   | -21846 |  0  |  2901  |  21845 |
| 70   | -21846 |  0  |  3413  |  21845 |
| 70   | -21846 |  0  |  3925  |  21845 |
| 70+  |  21845 |  1  |  2389  | -21846 |
| 71   |  21845 |  1  |  2389  |  21845 |
| 71+  | -21846 |  1  |  2901  |  21845 |
| 72   | -21846 |  1  |  2901  | -21846 |
| 72+  | -21846 |  0  |   341  |  21845 |
| 73   | -21846 |  0  |   341  |  21845 |
| 73   | -21846 |  0  |   853  |  21845 |
| 73   | -21846 |  0  |  1365  |  21845 |
| 73   | -21846 |  0  |  1877  |  21845 |
| 73   | -21846 |  0  |  2389  |  21845 |
| 73   | -21846 |  0  |  2901  | -21846 |
| 73   | -21846 |  0  |  3413  |  21845 |
| 73   | -21846 |  0  |  3925  |  21845 |
| 73+  |  21845 |  1  |  2901  | -21846 |
| 74   |  21845 |  1  |  2901  |  21845 |
| 74+  | -21846 |  1  |  3413  |  21845 |
| 75   | -21846 |  1  |  3413  | -21846 |
| 75+  | -21846 |  0  |   341  |  21845 |
| 76   | -21846 |  0  |   341  |  21845 |
| 76   | -21846 |  0  |   853  |  21845 |
| 76   | -21846 |  0  |  1365  |  21845 |
| 76   | -21846 |  0  |  1877  |  21845 |
| 76   | -21846 |  0  |  2389  |  21845 |
| 76   | -21846 |  0  |  2901  |  21845 |
| 76   | -21846 |  0  |  3413  | -21846 |
| 76   | -21846 |  0  |  3925  |  21845 |
| 76+  |  21845 |  1  |  3413  | -21846 |
| 77   |  21845 |  1  |  3413  |  21845 |
| 77+  | -21846 |  1  |  3925  |  21845 |
| 78   | -21846 |  1  |  3925  | -21846 |
| 78+  | -21846 |  0  |   341  |  21845 |
| 79   | -21846 |  0  |   341  |  21845 |
| 79   | -21846 |  0  |   853  |  21845 |
| 79   | -21846 |  0  |  1365  |  21845 |
| 79   | -21846 |  0  |  1877  |  21845 |
| 79   | -21846 |  0  |  2389  |  21845 |
| 79   | -21846 |  0  |  2901  |  21845 |
| 79   | -21846 |  0  |  3413  |  21845 |
| 79   | -21846 |  0  |  3925  | -21846 |
| 79+  |  21845 |  1  |  3925  | -21846 |
| 80   |  21845 |  1  |  3925  |  21845 |
| 80+  |  21845 |  0  |   341  |  21845 |
| 81   |  21845 |  0  |   341  |  21845 |
| 81   |  21845 |  0  |   853  |  21845 |
| 81   |  21845 |  0  |  1365  |  21845 |
| 81   |  21845 |  0  |  1877  |  21845 |
| 81   |  21845 |  0  |  2389  |  21845 |
| 81   |  21845 |  0  |  2901  |  21845 |
| 81   |  21845 |  0  |  3413  |  21845 |
| 81   |  21845 |  0  |  3925  |  21845 |
`).addBuiltin('verilog', `
module RAM4K (
  input clock,
  input load_0,
  input address_0,
  input address_1,
  input address_2,
  input address_3,
  input address_4,
  input address_5,
  input address_6,
  input address_7,
  input address_8,
  input address_9,
  input address_10,
  input address_11,
  input in_0,
  input in_1,
  input in_2,
  input in_3,
  input in_4,
  input in_5,
  input in_6,
  input in_7,
  input in_8,
  input in_9,
  input in_10,
  input in_11,
  input in_12,
  input in_13,
  input in_14,
  input in_15,
  output out_0,
  output out_1,
  output out_2,
  output out_3,
  output out_4,
  output out_5,
  output out_6,
  output out_7,
  output out_8,
  output out_9,
  output out_10,
  output out_11,
  output out_12,
  output out_13,
  output out_14,
  output out_15
);
  wire [15:0] din = {
    in_15,
    in_14,
    in_13,
    in_12,
    in_11,
    in_10,
    in_9,
    in_8,
    in_7,
    in_6,
    in_5,
    in_4,
    in_3,
    in_2,
    in_1,
    in_0
  };

  wire [11:0] address = {
    address_11,
    address_10,
    address_9,
    address_8,
    address_7,
    address_6,
    address_5,
    address_4,
    address_3,
    address_2,
    address_1,
    address_0
  };

  reg [15:0] dout; // Register for output.
  reg [15:0] mem [0:100];

  always @(posedge clock)
  begin
    if (load_0)
      mem[(address_0)] <= din;
    dout = mem[address_0]; // Output register controlled by clock.
  end

  assign out_0 = dout[0];
  assign out_1 = dout[1];
  assign out_2 = dout[2];
  assign out_3 = dout[3];
  assign out_4 = dout[4];
  assign out_5 = dout[5];
  assign out_6 = dout[6];
  assign out_7 = dout[7];
  assign out_8 = dout[8];
  assign out_9 = dout[9];
  assign out_10 = dout[10];
  assign out_11 = dout[11];
  assign out_12 = dout[12];
  assign out_13 = dout[13];
  assign out_14 = dout[14];
  assign out_15 = dout[15];

  assign o_LED_1 = out_0;
  assign o_LED_2 = out_1;
  assign o_LED_3 = out_2;
  assign o_LED_4 = out_3;
endmodule
`);
