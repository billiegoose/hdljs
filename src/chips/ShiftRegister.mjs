import { ChipDef } from '../components/ChipDef.mjs';

export const ShiftRegister = new ChipDef(`
CHIP ShiftRegister {
  IN in[16], load;
  OUT out, working, available;

  PARTS:
  Mux16(
    sel=load,
    out=tmp,
    a[0]=out1,
    a[1]=out2,
    a[2]=out3,
    a[3]=out4,
    a[4]=out5,
    a[5]=out6,
    a[6]=out7,
    a[7]=out8,
    a[8]=out9,
    a[9]=out10,
    a[10]=out11,
    a[11]=out12,
    a[12]=out13,
    a[13]=out14,
    a[14]=out15,
    a[15]=0,
    b=in
  );
  Bit(in=tmp[15], load=1, out=out15);
  Bit(in=tmp[14], load=1, out=out14);
  Bit(in=tmp[13], load=1, out=out13);
  Bit(in=tmp[12], load=1, out=out12);
  Bit(in=tmp[11], load=1, out=out11);
  Bit(in=tmp[10], load=1, out=out10);
  Bit(in=tmp[9], load=1, out=out9);
  Bit(in=tmp[8], load=1, out=out8);
  Bit(in=tmp[7], load=1, out=out7);
  Bit(in=tmp[6], load=1, out=out6);
  Bit(in=tmp[5], load=1, out=out5);
  Bit(in=tmp[4], load=1, out=out4);
  Bit(in=tmp[3], load=1, out=out3);
  Bit(in=tmp[2], load=1, out=out2);
  Bit(in=tmp[1], load=1, out=out1);
  Bit(in=tmp[0], load=1, out=out);
  
  Mux16(
    sel=load,
    out=wtmp,
    a[0]=working1,
    a[1]=working2,
    a[2]=working3,
    a[3]=working4,
    a[4]=working5,
    a[5]=working6,
    a[6]=working7,
    a[7]=working8,
    a[8]=working9,
    a[9]=working10,
    a[10]=working11,
    a[11]=working12,
    a[12]=working13,
    a[13]=working14,
    a[14]=working15,
    a[15]=0,
    b[0]=1,
    b[1]=1,
    b[2]=1,
    b[3]=1,
    b[4]=1,
    b[5]=1,
    b[6]=1,
    b[7]=1,
    b[8]=1,
    b[9]=1,
    b[10]=1,
    b[11]=1,
    b[12]=1,
    b[13]=1,
    b[14]=1,
    b[15]=1
  );
  Bit(in=wtmp[15], load=1, out=working15);
  Bit(in=wtmp[14], load=1, out=working14);
  Bit(in=wtmp[13], load=1, out=working13);
  Bit(in=wtmp[12], load=1, out=working12);
  Bit(in=wtmp[11], load=1, out=working11);
  Bit(in=wtmp[10], load=1, out=working10);
  Bit(in=wtmp[9], load=1, out=working9);
  Bit(in=wtmp[8], load=1, out=working8);
  Bit(in=wtmp[7], load=1, out=working7);
  Bit(in=wtmp[6], load=1, out=working6);
  Bit(in=wtmp[5], load=1, out=working5);
  Bit(in=wtmp[4], load=1, out=working4);
  Bit(in=wtmp[3], load=1, out=working3);
  Bit(in=wtmp[2], load=1, out=working2);
  Bit(in=wtmp[1], load=1, out=working1);
  Bit(in=wtmp[0], load=1, out=working);
  Not(in=working, out=available);
}`).test(`
| time |             in   |load | out | working | available |
| 0+   |                0 |  0  |  0  |    0    |     1     |
| 1    |                0 |  0  |  0  |    0    |     1     |
| 1+   |                0 |  0  |  0  |    0    |     1     |
| 2    |                0 |  0  |  0  |    0    |     1     |
| 2+   |           -32123 |  0  |  0  |    0    |     1     |
| 3    |           -32123 |  0  |  0  |    0    |     1     |
| 3+   |            11111 |  0  |  0  |    0    |     1     |
| 4    |            11111 |  0  |  0  |    0    |     1     |
| 4+   | 1110111011101110 |  1  |  0  |    0    |     1     |
| 5    |                0 |  1  |  0  |    1    |     0     |
| 5+   |                0 |  0  |  0  |    1    |     0     |
| 6    |                0 |  0  |  1  |    1    |     0     |
| 6+   |                0 |  0  |  1  |    1    |     0     |
| 7    |                0 |  0  |  1  |    1    |     0     |
| 7+   |            12345 |  0  |  1  |    1    |     0     |
| 8    |            12345 |  0  |  1  |    1    |     0     |
| 8+   |                0 |  0  |  1  |    1    |     0     |
| 9    |                0 |  0  |  0  |    1    |     0     |
| 9+   |                0 |  0  |  0  |    1    |     0     |
| 10   |                0 |  0  |  1  |    1    |     0     |
| 10+  |                1 |  0  |  1  |    1    |     0     |
| 11   |                1 |  0  |  1  |    1    |     0     |
| 11+  |                1 |  0  |  1  |    1    |     0     |
| 12   |                1 |  0  |  1  |    1    |     0     |
| 12+  |                2 |  0  |  1  |    1    |     0     |
| 13   |                2 |  0  |  0  |    1    |     0     |
| 13+  |                2 |  0  |  0  |    1    |     0     |
| 14   |                2 |  0  |  1  |    1    |     0     |
| 14+  |                4 |  0  |  1  |    1    |     0     |
| 15   |                4 |  0  |  1  |    1    |     0     |
| 15+  |                4 |  0  |  1  |    1    |     0     |
| 16   |                4 |  0  |  1  |    1    |     0     |
| 16+  |                8 |  0  |  1  |    1    |     0     |
| 17   |                8 |  0  |  0  |    1    |     0     |
| 17+  |                8 |  0  |  0  |    1    |     0     |
| 18   |                8 |  0  |  1  |    1    |     0     |
| 18+  |               16 |  0  |  1  |    1    |     0     |
| 19   |               16 |  0  |  1  |    1    |     0     |
| 19+  |               16 |  0  |  1  |    1    |     0     |
| 20   |               16 |  0  |  1  |    1    |     0     |
| 20+  |               32 |  0  |  1  |    1    |     0     |
| 21   |               32 |  0  |  0  |    0    |     1     |
| 21+  |               32 |  0  |  0  |    0    |     1     |
| 22   |               32 |  0  |  0  |    0    |     1     |
| 22+  |               64 |  0  |  0  |    0    |     1     |
| 23   |               64 |  0  |  0  |    0    |     1     |
| 23+  |               64 |  1  |  0  |    0    |     1     |
| 24   |               64 |  1  |  0  |    1    |     0     |
| 24+  |              128 |  1  |  0  |    1    |     0     |
| 25   |              128 |  1  |  0  |    1    |     0     |
| 25+  |              128 |  0  |  0  |    1    |     0     |
| 26   |              128 |  0  |  0  |    1    |     0     |
| 26+  |              256 |  0  |  0  |    1    |     0     |
| 27   |              256 |  0  |  0  |    1    |     0     |
| 27+  |              256 |  0  |  0  |    1    |     0     |
| 28   |              256 |  0  |  0  |    1    |     0     |
| 28+  |              512 |  0  |  0  |    1    |     0     |
| 29   |              512 |  0  |  0  |    1    |     0     |
| 29+  |              512 |  0  |  0  |    1    |     0     |
| 30   |              512 |  0  |  0  |    1    |     0     |
| 30+  |             1024 |  0  |  0  |    1    |     0     |
| 31   |             1024 |  0  |  0  |    1    |     0     |
| 31+  |             1024 |  0  |  0  |    1    |     0     |
| 32   |             1024 |  0  |  1  |    1    |     0     |
| 32+  |             2048 |  0  |  1  |    1    |     0     |
| 33   |             2048 |  0  |  0  |    1    |     0     |
| 33+  |             2048 |  0  |  0  |    1    |     0     |
| 34   |             2048 |  0  |  0  |    1    |     0     |
| 34+  |             4096 |  0  |  0  |    1    |     0     |
| 35   |             4096 |  0  |  0  |    1    |     0     |
| 35+  |             4096 |  0  |  0  |    1    |     0     |
| 36   |             4096 |  0  |  0  |    1    |     0     |
| 36+  |             8192 |  0  |  0  |    1    |     0     |
| 37   |             8192 |  0  |  0  |    1    |     0     |
| 37+  |             8192 |  0  |  0  |    1    |     0     |
| 38   |             8192 |  0  |  0  |    1    |     0     |
| 38+  |            16384 |  0  |  0  |    1    |     0     |
| 39   |            16384 |  0  |  0  |    1    |     0     |
| 39+  |            16384 |  0  |  0  |    1    |     0     |
| 40   |            16384 |  0  |  0  |    1    |     0     |
| 40+  |           -32768 |  0  |  0  |    1    |     0     |
| 41   |           -32768 |  0  |  0  |    0    |     1     |
| 41+  | 0101010101010101 |  1  |  0  |    0    |     1     |
| 42   |           -32768 |  1  |  1  |    1    |     0     |
| 42+  |               -2 |  0  |  1  |    1    |     0     |
| 43   |               -2 |  0  |  0  |    1    |     0     |
| 43+  |               -2 |  0  |  0  |    1    |     0     |
| 44   |               -2 |  0  |  1  |    1    |     0     |
| 44+  |               -3 |  0  |  1  |    1    |     0     |
| 45   |               -3 |  0  |  0  |    1    |     0     |
| 45+  |               -3 |  0  |  0  |    1    |     0     |
| 46   |               -3 |  0  |  1  |    1    |     0     |
| 46+  |               -5 |  0  |  1  |    1    |     0     |
| 47   |               -5 |  0  |  0  |    1    |     0     |
| 47+  |               -5 |  0  |  0  |    1    |     0     |
| 48   |               -5 |  0  |  1  |    1    |     0     |
| 48+  |               -9 |  0  |  1  |    1    |     0     |
| 49   |               -9 |  0  |  0  |    1    |     0     |
| 49+  |               -9 |  0  |  0  |    1    |     0     |
| 50   |               -9 |  0  |  1  |    1    |     0     |
| 50+  |              -17 |  0  |  1  |    1    |     0     |
| 51   |              -17 |  0  |  0  |    1    |     0     |
| 51+  | 1000000000000000 |  1  |  0  |    1    |     0     |
| 52   |              -17 |  0  |  0  |    1    |     0     |
| 52+  |              -33 |  0  |  0  |    1    |     0     |
| 53   |              -33 |  0  |  0  |    1    |     0     |
| 53+  |              -33 |  0  |  0  |    1    |     0     |
| 54   |              -33 |  0  |  0  |    1    |     0     |
| 54+  |              -65 |  0  |  0  |    1    |     0     |
| 55   |              -65 |  0  |  0  |    1    |     0     |
| 55+  |              -65 |  0  |  0  |    1    |     0     |
| 56   |              -65 |  0  |  0  |    1    |     0     |
| 56+  |             -129 |  0  |  0  |    1    |     0     |
| 57   |             -129 |  0  |  0  |    1    |     0     |
| 57+  |             -129 |  0  |  0  |    1    |     0     |
| 58   |             -129 |  0  |  0  |    1    |     0     |
| 58+  |             -257 |  0  |  0  |    1    |     0     |
| 59   |             -257 |  0  |  0  |    1    |     0     |
| 59+  |             -257 |  0  |  0  |    1    |     0     |
| 60   |             -257 |  0  |  0  |    1    |     0     |
| 60+  |             -513 |  0  |  0  |    1    |     0     |
| 61   |             -513 |  0  |  0  |    1    |     0     |
| 61+  |             -513 |  0  |  0  |    1    |     0     |
| 62   |             -513 |  0  |  0  |    1    |     0     |
| 62+  |            -1025 |  0  |  0  |    1    |     0     |
| 63   |            -1025 |  0  |  0  |    1    |     0     |
| 63+  |            -1025 |  0  |  0  |    1    |     0     |
| 64   |            -1025 |  0  |  0  |    1    |     0     |
| 64+  |            -2049 |  0  |  0  |    1    |     0     |
| 65   |            -2049 |  0  |  0  |    1    |     0     |
| 65+  |            -2049 |  0  |  0  |    1    |     0     |
| 66   |            -2049 |  0  |  0  |    1    |     0     |
| 66+  |            -4097 |  0  |  0  |    1    |     0     |
| 67   |            -4097 |  0  |  1  |    1    |     0     |
| 67+  |            -4097 |  0  |  1  |    1    |     0     |
| 68   |            -4097 |  0  |  0  |    0    |     1     |
| 68+  |            -8193 |  0  |  0  |    0    |     1     |
| 69   |            -8193 |  0  |  0  |    0    |     1     |
| 69+  |            -8193 |  0  |  0  |    0    |     1     |
| 70   |            -8193 |  0  |  0  |    0    |     1     |
| 70+  |           -16385 |  0  |  0  |    0    |     1     |
| 71   |           -16385 |  0  |  0  |    0    |     1     |
| 71+  |           -16385 |  0  |  0  |    0    |     1     |
| 72   |           -16385 |  0  |  0  |    0    |     1     |
| 72+  |            32767 |  0  |  0  |    0    |     1     |
| 73   |            32767 |  0  |  0  |    0    |     1     |
| 73+  |            32767 |  0  |  0  |    0    |     1     |
| 74   |            32767 |  0  |  0  |    0    |     1     |
`);
