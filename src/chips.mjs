
global.chipRegistry = new Map();

import { ChipDef } from './components/ChipDef.mjs';

export const Nand = new ChipDef(`
CHIP Nand {
  IN a,b;
  OUT out;
}`)

export const Copy = new ChipDef(`
CHIP Copy {
  IN in;
  OUT out;
}`);

export const Not = new ChipDef(`
CHIP Not {
  IN in;
  OUT out;

  PARTS:
  Nand(a=in, b=in, out=out);
}`).test(`
|  in   |  out  |
|   0   |   1   |
|   1   |   0   |
`);

export const And = new ChipDef(`
CHIP And {
  IN a, b;
  OUT out;

  PARTS:
  Nand(a=a, b=b, out=c);
  Not(in=c, out=out);
}`).test(`
|   a   |   b   |  out  |
|   0   |   0   |   0   |
|   0   |   1   |   0   |
|   1   |   0   |   0   |
|   1   |   1   |   1   |
`)

export const Or = new ChipDef(`
CHIP Or {
  IN a, b;
  OUT out;

  PARTS:
  Not(in=a, out=na);
  Not(in=b, out=nb);
  Nand(a=na, b=nb, out=out);
}`).test(`
|   a   |   b   |  out  |
|   0   |   0   |   0   |
|   0   |   1   |   1   |
|   1   |   0   |   1   |
|   1   |   1   |   1   |
`)

export const Xor = new ChipDef(`
CHIP Xor {
  IN a, b;
  OUT out;

  PARTS:
  Nand(a=a, b=b, out=x);
  Nand(a=a, b=x, out=y);
  Nand(a=x, b=b, out=z);
  Nand(a=y, b=z, out=out);
}`).test(`
|   a   |   b   |  out  |
|   0   |   0   |   0   |
|   0   |   1   |   1   |
|   1   |   0   |   1   |
|   1   |   1   |   0   |
`)

export const Mux = new ChipDef(`
CHIP Mux {
  IN sel, a, b;
  OUT out;

  PARTS:
  Not(in=sel, out=nsel);
  Nand(a=nsel, b=a, out=sela);
  Nand(a=sel, b=b, out=selb);
  Nand(a=sela, b=selb, out=out);
}`).test(`
|   a   |   b   |  sel  |  out  |
|   0   |   0   |   0   |   0   |
|   0   |   0   |   1   |   0   |
|   0   |   1   |   0   |   0   |
|   0   |   1   |   1   |   1   |
|   1   |   0   |   0   |   1   |
|   1   |   0   |   1   |   0   |
|   1   |   1   |   0   |   1   |
|   1   |   1   |   1   |   1   |
`)

export const DMux = new ChipDef(`
CHIP DMux {
  IN sel, in;
  OUT a, b;

  PARTS:
  Not(in=sel, out=nsel);
  And(a=in, b=nsel, out=a);
  And(a=in, b=sel, out=b);
}`).test(`
|  in   |  sel  |   a   |   b   |
|   0   |   0   |   0   |   0   |
|   0   |   1   |   0   |   0   |
|   1   |   0   |   1   |   0   |
|   1   |   1   |   0   |   1   |
`)

export const Or8Way = new ChipDef(`
CHIP Or8Way {
  IN in[8];
  OUT out;

  PARTS:
  Or(a=in[0], b=in[1], out=c0);
  Or(a=in[2], b=in[3], out=c1);
  Or(a=in[4], b=in[5], out=c2);
  Or(a=in[6], b=in[7], out=c3);
  Or(a=c0, b=c1, out=d0);
  Or(a=c2, b=c3, out=d1);
  Or(a=d0, b=d1, out=out);
}`).test(`
|     in     | out |
|  00000000  |  0  |
|  11111111  |  1  |
|  00010000  |  1  |
|  00000001  |  1  |
|  00100110  |  1  |
`)

export const Or16Way = new ChipDef(`
CHIP Or16Way {
  IN in[16];
  OUT out;

  PARTS:
  Or8Way(in=in[0..7], out=low);
  Or8Way(in=in[8..15], out=high);
  Or(a=low, b=high, out=out);
}`)

export const Not16 = new ChipDef(`
CHIP Not16 {
  IN in[16];
  OUT out[16];

  PARTS:
  Not(in=in[0], out=out[0]);
  Not(in=in[1], out=out[1]);
  Not(in=in[2], out=out[2]);
  Not(in=in[3], out=out[3]);
  Not(in=in[4], out=out[4]);
  Not(in=in[5], out=out[5]);
  Not(in=in[6], out=out[6]);
  Not(in=in[7], out=out[7]);
  Not(in=in[8], out=out[8]);
  Not(in=in[9], out=out[9]);
  Not(in=in[10],out=out[10]);
  Not(in=in[11],out=out[11]);
  Not(in=in[12],out=out[12]);
  Not(in=in[13],out=out[13]);
  Not(in=in[14],out=out[14]);
  Not(in=in[15],out=out[15]);
}`).test(`
|        in        |       out        |
| 0000000000000000 | 1111111111111111 |
| 1111111111111111 | 0000000000000000 |
| 1010101010101010 | 0101010101010101 |
| 0011110011000011 | 1100001100111100 |
| 0001001000110100 | 1110110111001011 |
`)

export const And16 = new ChipDef(`
CHIP And16 {
  IN a[16], b[16];
  OUT out[16];

  PARTS:
  And(a=a[0], b=b[0], out=out[0]);
  And(a=a[1], b=b[1], out=out[1]);
  And(a=a[2], b=b[2], out=out[2]);
  And(a=a[3], b=b[3], out=out[3]);
  And(a=a[4], b=b[4], out=out[4]);
  And(a=a[5], b=b[5], out=out[5]);
  And(a=a[6], b=b[6], out=out[6]);
  And(a=a[7], b=b[7], out=out[7]);
  And(a=a[8], b=b[8], out=out[8]);
  And(a=a[9], b=b[9], out=out[9]);
  And(a=a[10], b=b[10], out=out[10]);
  And(a=a[11], b=b[11], out=out[11]);
  And(a=a[12], b=b[12], out=out[12]);
  And(a=a[13], b=b[13], out=out[13]);
  And(a=a[14], b=b[14], out=out[14]);
  And(a=a[15], b=b[15], out=out[15]);
}`).test(`
|        a         |        b         |       out        |
| 0000000000000000 | 0000000000000000 | 0000000000000000 |
| 0000000000000000 | 1111111111111111 | 0000000000000000 |
| 1111111111111111 | 1111111111111111 | 1111111111111111 |
| 1010101010101010 | 0101010101010101 | 0000000000000000 |
| 0011110011000011 | 0000111111110000 | 0000110011000000 |
| 0001001000110100 | 1001100001110110 | 0001000000110100 |
`)

export const Or16 = new ChipDef(`
CHIP Or16 {
  IN a[16], b[16];
  OUT out[16];

  PARTS:
  Or(a=a[0], b=b[0], out=out[0]);
  Or(a=a[1], b=b[1], out=out[1]);
  Or(a=a[2], b=b[2], out=out[2]);
  Or(a=a[3], b=b[3], out=out[3]);
  Or(a=a[4], b=b[4], out=out[4]);
  Or(a=a[5], b=b[5], out=out[5]);
  Or(a=a[6], b=b[6], out=out[6]);
  Or(a=a[7], b=b[7], out=out[7]);
  Or(a=a[8], b=b[8], out=out[8]);
  Or(a=a[9], b=b[9], out=out[9]);
  Or(a=a[10], b=b[10], out=out[10]);
  Or(a=a[11], b=b[11], out=out[11]);
  Or(a=a[12], b=b[12], out=out[12]);
  Or(a=a[13], b=b[13], out=out[13]);
  Or(a=a[14], b=b[14], out=out[14]);
  Or(a=a[15], b=b[15], out=out[15]);
}`).test(`
|        a         |        b         |       out        |
| 0000000000000000 | 0000000000000000 | 0000000000000000 |
| 0000000000000000 | 1111111111111111 | 1111111111111111 |
| 1111111111111111 | 1111111111111111 | 1111111111111111 |
| 1010101010101010 | 0101010101010101 | 1111111111111111 |
| 0011110011000011 | 0000111111110000 | 0011111111110011 |
| 0001001000110100 | 1001100001110110 | 1001101001110110 |
`)

export const DMux4Way = new ChipDef(`
CHIP DMux4Way {
  IN sel[2], in;
  OUT a, b, c, d;

  PARTS:
  DMux(in=in, sel=sel[1], a=x, b=y);
  DMux(in=x, sel=sel[0], a=a, b=b);
  DMux(in=y, sel=sel[0], a=c, b=d);
}`).test(`
| in  | sel  |  a  |  b  |  c  |  d  |
|  0  |  00  |  0  |  0  |  0  |  0  |
|  0  |  01  |  0  |  0  |  0  |  0  |
|  0  |  10  |  0  |  0  |  0  |  0  |
|  0  |  11  |  0  |  0  |  0  |  0  |
|  1  |  00  |  1  |  0  |  0  |  0  |
|  1  |  01  |  0  |  1  |  0  |  0  |
|  1  |  10  |  0  |  0  |  1  |  0  |
|  1  |  11  |  0  |  0  |  0  |  1  |
`)

export const Mux16 = new ChipDef(`
CHIP Mux16 {
  IN sel, a[16], b[16];
  OUT out[16];

  PARTS:
  Mux(a=a[0], b=b[0], sel=sel, out=out[0]);
  Mux(a=a[1], b=b[1], sel=sel, out=out[1]);
  Mux(a=a[2], b=b[2], sel=sel, out=out[2]);
  Mux(a=a[3], b=b[3], sel=sel, out=out[3]);
  Mux(a=a[4], b=b[4], sel=sel, out=out[4]);
  Mux(a=a[5], b=b[5], sel=sel, out=out[5]);
  Mux(a=a[6], b=b[6], sel=sel, out=out[6]);
  Mux(a=a[7], b=b[7], sel=sel, out=out[7]);
  Mux(a=a[8], b=b[8], sel=sel, out=out[8]);
  Mux(a=a[9], b=b[9], sel=sel, out=out[9]);
  Mux(a=a[10], b=b[10], sel=sel, out=out[10]);
  Mux(a=a[11], b=b[11], sel=sel, out=out[11]);
  Mux(a=a[12], b=b[12], sel=sel, out=out[12]);
  Mux(a=a[13], b=b[13], sel=sel, out=out[13]);
  Mux(a=a[14], b=b[14], sel=sel, out=out[14]);
  Mux(a=a[15], b=b[15], sel=sel, out=out[15]);
}`).test(`
|        a         |        b         | sel |       out        |
| 0000000000000000 | 0000000000000000 |  0  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 |  1  | 0000000000000000 |
| 0000000000000000 | 0001001000110100 |  0  | 0000000000000000 |
| 0000000000000000 | 0001001000110100 |  1  | 0001001000110100 |
| 1001100001110110 | 0000000000000000 |  0  | 1001100001110110 |
| 1001100001110110 | 0000000000000000 |  1  | 0000000000000000 |
| 1010101010101010 | 0101010101010101 |  0  | 1010101010101010 |
| 1010101010101010 | 0101010101010101 |  1  | 0101010101010101 |
`)

export const DMux8Way = new ChipDef(`
CHIP DMux8Way {
  IN sel[3], in;
  OUT a, b, c, d, e, f, g, h;

  PARTS:
  DMux(in=in, sel=sel[2], a=x, b=y);
  DMux4Way(in=x, sel=sel[0..1], a=a, b=b, c=c, d=d);
  DMux4Way(in=y, sel=sel[0..1], a=e, b=f, c=g, d=h);
}`).test(`
| in  |  sel  |  a  |  b  |  c  |  d  |  e  |  f  |  g  |  h  |
|  0  |  000  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  0  |  001  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  0  |  010  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  0  |  011  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  0  |  100  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  0  |  101  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  0  |  110  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  0  |  111  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  1  |  000  |  1  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |
|  1  |  001  |  0  |  1  |  0  |  0  |  0  |  0  |  0  |  0  |
|  1  |  010  |  0  |  0  |  1  |  0  |  0  |  0  |  0  |  0  |
|  1  |  011  |  0  |  0  |  0  |  1  |  0  |  0  |  0  |  0  |
|  1  |  100  |  0  |  0  |  0  |  0  |  1  |  0  |  0  |  0  |
|  1  |  101  |  0  |  0  |  0  |  0  |  0  |  1  |  0  |  0  |
|  1  |  110  |  0  |  0  |  0  |  0  |  0  |  0  |  1  |  0  |
|  1  |  111  |  0  |  0  |  0  |  0  |  0  |  0  |  0  |  1  |
`)

export const Mux4Way16 = new ChipDef(`
CHIP Mux4Way16 {
  IN sel[2], a[16], b[16], c[16], d[16];
  OUT out[16];

  PARTS:
  Mux16(a=a, b=b, sel=sel[0], out=x);
  Mux16(a=c, b=d, sel=sel[0], out=y);
  Mux16(a=x, b=y, sel=sel[1], out=out);
}`).test(`
|        a         |        b         |        c         |        d         | sel  |       out        |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  00  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  01  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  10  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  11  | 0000000000000000 |
| 0001001000110100 | 1001100001110110 | 1010101010101010 | 0101010101010101 |  00  | 0001001000110100 |
| 0001001000110100 | 1001100001110110 | 1010101010101010 | 0101010101010101 |  01  | 1001100001110110 |
| 0001001000110100 | 1001100001110110 | 1010101010101010 | 0101010101010101 |  10  | 1010101010101010 |
| 0001001000110100 | 1001100001110110 | 1010101010101010 | 0101010101010101 |  11  | 0101010101010101 |
`)

export const Mux8Way16 = new ChipDef(`
CHIP Mux8Way16 {
  IN sel[3], a[16], b[16], c[16], d[16], e[16], f[16], g[16], h[16];
  OUT out[16];

  PARTS:
  Mux4Way16(a=a, b=b, c=c, d=d, sel=sel[0..1], out=x);
  Mux4Way16(a=e, b=f, c=g, d=h, sel=sel[0..1], out=y);
  Mux16(a=x, b=y, sel=sel[2], out=out);
}`).test(`
|        a         |        b         |        c         |        d         |        e         |        f         |        g         |        h         |  sel  |       out        |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  000  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  001  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  010  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  011  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  100  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  101  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  110  | 0000000000000000 |
| 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 | 0000000000000000 |  111  | 0000000000000000 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  000  | 0001001000110100 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  001  | 0010001101000101 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  010  | 0011010001010110 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  011  | 0100010101100111 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  100  | 0101011001111000 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  101  | 0110011110001001 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  110  | 0111100010011010 |
| 0001001000110100 | 0010001101000101 | 0011010001010110 | 0100010101100111 | 0101011001111000 | 0110011110001001 | 0111100010011010 | 1000100110101011 |  111  | 1000100110101011 |
`)

export const HalfAdder = new ChipDef(`
CHIP HalfAdder {
  IN a, b;
  OUT sum, carry;

  PARTS:
  Xor(a=a, b=b, out=sum);
  And(a=a, b=b, out=carry);
}`).test(`
|   a   |   b   |  sum  | carry |
|   0   |   0   |   0   |   0   |
|   0   |   1   |   1   |   0   |
|   1   |   0   |   1   |   0   |
|   1   |   1   |   0   |   1   |
`)

export const FullAdder = new ChipDef(`
CHIP FullAdder {
  IN a, b, c;
  OUT sum, carry;

  PARTS:
  HalfAdder(a=a, b=b, sum=x, carry=y);
  HalfAdder(a=x, b=c, sum=sum, carry=z);
  Or(a=y, b=z, out=carry);
}`).test(`
|   a   |   b   |   c   |  sum  | carry |
|   0   |   0   |   0   |   0   |   0   |
|   0   |   0   |   1   |   1   |   0   |
|   0   |   1   |   0   |   1   |   0   |
|   0   |   1   |   1   |   0   |   1   |
|   1   |   0   |   0   |   1   |   0   |
|   1   |   0   |   1   |   0   |   1   |
|   1   |   1   |   0   |   0   |   1   |
|   1   |   1   |   1   |   1   |   1   |
`)

export const Add16 = new ChipDef(`
CHIP Add16 {
  IN a[16], b[16];
  OUT out[16], overflow;

  PARTS:
  HalfAdder(a=a[0], b=b[0], sum=out[0], carry=c1);
  FullAdder(a=a[1], b=b[1], c=c1, sum=out[1], carry=c2);
  FullAdder(a=a[2], b=b[2], c=c2, sum=out[2], carry=c3);
  FullAdder(a=a[3], b=b[3], c=c3, sum=out[3], carry=c4);
  FullAdder(a=a[4], b=b[4], c=c4, sum=out[4], carry=c5);
  FullAdder(a=a[5], b=b[5], c=c5, sum=out[5], carry=c6);
  FullAdder(a=a[6], b=b[6], c=c6, sum=out[6], carry=c7);
  FullAdder(a=a[7], b=b[7], c=c7, sum=out[7], carry=c8);
  FullAdder(a=a[8], b=b[8], c=c8, sum=out[8], carry=c9);
  FullAdder(a=a[9], b=b[9], c=c9, sum=out[9], carry=c10);
  FullAdder(a=a[10], b=b[10], c=c10, sum=out[10], carry=c11);
  FullAdder(a=a[11], b=b[11], c=c11, sum=out[11], carry=c12);
  FullAdder(a=a[12], b=b[12], c=c12, sum=out[12], carry=c13);
  FullAdder(a=a[13], b=b[13], c=c13, sum=out[13], carry=c14);
  FullAdder(a=a[14], b=b[14], c=c14, sum=out[14], carry=c15);
  FullAdder(a=a[15], b=b[15], c=c15, sum=out[15], carry=overflow);
}`).test(`
|        a         |        b         |       out        | overflow |
| 0000000000000000 | 0000000000000000 | 0000000000000000 |     0    |
| 0000000000000000 | 1111111111111111 | 1111111111111111 |     0    |
| 1111111111111111 | 1111111111111111 | 1111111111111110 |     1    |
| 1010101010101010 | 0101010101010101 | 1111111111111111 |     0    |
| 0011110011000011 | 0000111111110000 | 0100110010110011 |     0    |
| 0001001000110100 | 1001100001110110 | 1010101010101010 |     0    |
`)


export const Inc16 = new ChipDef(`
CHIP Inc16 {
  IN in[16];
  OUT out[16];

  PARTS:
  Add16(a=in, b[0]=1, out=out);
}
`)
.test(`
|        in        |       out        |
| 0000000000000000 | 0000000000000001 |
| 1111111111111111 | 0000000000000000 |
| 0000000000000101 | 0000000000000110 |
| 1111111111111011 | 1111111111111100 |
`)

/*
export const ALU = new ChipDef(`
CHIP ALU {
  IN zx, nx, zy, ny, f, no, x[16], y[16];
  OUT out[16], zr, ng;

  PARTS:
  Mux16(sel=zx, a=x, b=0, out=x1);
  Mux16(sel=zy, a=y, b=0, out=y1);
  Not16(in=x1, out=nx1);
  Not16(in=y1, out=ny1);
  Mux16(sel=nx, a=x1, b=nx1, out=x2);
  Mux16(sel=ny, a=y1, b=ny1, out=y2);
  And16(a=x2, b=y2, out=and);
  Add16(a=x2, b=y2, out=add);
  Mux16(sel=f, a=and, b=add, out=res);
  Not16(in=res, out=nres);
  Mux16(sel=no, a=res, b=nres, out=out);
  Or16Way(in=out, out=nz);
  Not(in=nz, out=zr);
  Or(a=out[15], b=0, out=ng);
}`).test(`
|        x         |        y         |zx |nx |zy |ny | f |no |       out        |zr |ng |
| 0000000000000000 | 1111111111111111 | 1 | 0 | 1 | 0 | 1 | 0 | 0000000000000000 | 1 | 0 |
| 0000000000000000 | 1111111111111111 | 1 | 1 | 1 | 1 | 1 | 1 | 0000000000000001 | 0 | 0 |
| 0000000000000000 | 1111111111111111 | 1 | 1 | 1 | 0 | 1 | 0 | 1111111111111111 | 0 | 1 |
| 0000000000000000 | 1111111111111111 | 0 | 0 | 1 | 1 | 0 | 0 | 0000000000000000 | 1 | 0 |
| 0000000000000000 | 1111111111111111 | 1 | 1 | 0 | 0 | 0 | 0 | 1111111111111111 | 0 | 1 |
| 0000000000000000 | 1111111111111111 | 0 | 0 | 1 | 1 | 0 | 1 | 1111111111111111 | 0 | 1 |
| 0000000000000000 | 1111111111111111 | 1 | 1 | 0 | 0 | 0 | 1 | 0000000000000000 | 1 | 0 |
| 0000000000000000 | 1111111111111111 | 0 | 0 | 1 | 1 | 1 | 1 | 0000000000000000 | 1 | 0 |
| 0000000000000000 | 1111111111111111 | 1 | 1 | 0 | 0 | 1 | 1 | 0000000000000001 | 0 | 0 |
| 0000000000000000 | 1111111111111111 | 0 | 1 | 1 | 1 | 1 | 1 | 0000000000000001 | 0 | 0 |
| 0000000000000000 | 1111111111111111 | 1 | 1 | 0 | 1 | 1 | 1 | 0000000000000000 | 1 | 0 |
| 0000000000000000 | 1111111111111111 | 0 | 0 | 1 | 1 | 1 | 0 | 1111111111111111 | 0 | 1 |
| 0000000000000000 | 1111111111111111 | 1 | 1 | 0 | 0 | 1 | 0 | 1111111111111110 | 0 | 1 |
| 0000000000000000 | 1111111111111111 | 0 | 0 | 0 | 0 | 1 | 0 | 1111111111111111 | 0 | 1 |
| 0000000000000000 | 1111111111111111 | 0 | 1 | 0 | 0 | 1 | 1 | 0000000000000001 | 0 | 0 |
| 0000000000000000 | 1111111111111111 | 0 | 0 | 0 | 1 | 1 | 1 | 1111111111111111 | 0 | 1 |
| 0000000000000000 | 1111111111111111 | 0 | 0 | 0 | 0 | 0 | 0 | 0000000000000000 | 1 | 0 |
| 0000000000000000 | 1111111111111111 | 0 | 1 | 0 | 1 | 0 | 1 | 1111111111111111 | 0 | 1 |
| 0000000000010001 | 0000000000000011 | 1 | 0 | 1 | 0 | 1 | 0 | 0000000000000000 | 1 | 0 |
| 0000000000010001 | 0000000000000011 | 1 | 1 | 1 | 1 | 1 | 1 | 0000000000000001 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 1 | 1 | 1 | 0 | 1 | 0 | 1111111111111111 | 0 | 1 |
| 0000000000010001 | 0000000000000011 | 0 | 0 | 1 | 1 | 0 | 0 | 0000000000010001 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 1 | 1 | 0 | 0 | 0 | 0 | 0000000000000011 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 0 | 0 | 1 | 1 | 0 | 1 | 1111111111101110 | 0 | 1 |
| 0000000000010001 | 0000000000000011 | 1 | 1 | 0 | 0 | 0 | 1 | 1111111111111100 | 0 | 1 |
| 0000000000010001 | 0000000000000011 | 0 | 0 | 1 | 1 | 1 | 1 | 1111111111101111 | 0 | 1 |
| 0000000000010001 | 0000000000000011 | 1 | 1 | 0 | 0 | 1 | 1 | 1111111111111101 | 0 | 1 |
| 0000000000010001 | 0000000000000011 | 0 | 1 | 1 | 1 | 1 | 1 | 0000000000010010 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 1 | 1 | 0 | 1 | 1 | 1 | 0000000000000100 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 0 | 0 | 1 | 1 | 1 | 0 | 0000000000010000 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 1 | 1 | 0 | 0 | 1 | 0 | 0000000000000010 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 0 | 0 | 0 | 0 | 1 | 0 | 0000000000010100 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 0 | 1 | 0 | 0 | 1 | 1 | 0000000000001110 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 0 | 0 | 0 | 1 | 1 | 1 | 1111111111110010 | 0 | 1 |
| 0000000000010001 | 0000000000000011 | 0 | 0 | 0 | 0 | 0 | 0 | 0000000000000001 | 0 | 0 |
| 0000000000010001 | 0000000000000011 | 0 | 1 | 0 | 1 | 0 | 1 | 0000000000010011 | 0 | 0 |
`)

*/

export const DFF = new ChipDef(`
CHIP DFF {
  IN in;
  OUT out;
}`);

DFF.clocked = true;

export const Bit = new ChipDef(`
CHIP Bit {
  IN in, load;
  OUT out;

  PARTS:
  Mux(a=feedback, b=in, sel=load, out=val);
  DFF(in=val, out=feedback);
  Copy(in=feedback, out=out);
}`).test(`
| time | in  |load | out |
| 0+   |  0  |  0  |  0  |
| 1    |  0  |  0  |  0  |
| 1+   |  0  |  1  |  0  |
| 2    |  0  |  1  |  0  |
| 2+   |  1  |  0  |  0  |
| 3    |  1  |  0  |  0  |
| 3+   |  1  |  1  |  0  |
| 4    |  1  |  1  |  1  |
| 4+   |  0  |  0  |  1  |
| 5    |  0  |  0  |  1  |
| 5+   |  1  |  0  |  1  |
| 6    |  1  |  0  |  1  |
| 6+   |  0  |  1  |  1  |
| 7    |  0  |  1  |  0  |
| 7+   |  1  |  1  |  0  |
| 8    |  1  |  1  |  1  |
| 8+   |  0  |  0  |  1  |
| 9    |  0  |  0  |  1  |
| 9+   |  0  |  0  |  1  |
| 10   |  0  |  0  |  1  |
| 10+  |  0  |  0  |  1  |
| 11   |  0  |  0  |  1  |
| 11+  |  0  |  0  |  1  |
| 12   |  0  |  0  |  1  |
| 12+  |  0  |  0  |  1  |
| 13   |  0  |  0  |  1  |
| 13+  |  0  |  0  |  1  |
| 14   |  0  |  0  |  1  |
| 14+  |  0  |  0  |  1  |
| 15   |  0  |  0  |  1  |
| 15+  |  0  |  0  |  1  |
| 16   |  0  |  0  |  1  |
| 16+  |  0  |  0  |  1  |
| 17   |  0  |  0  |  1  |
| 17+  |  0  |  0  |  1  |
| 18   |  0  |  0  |  1  |
| 18+  |  0  |  0  |  1  |
| 19   |  0  |  0  |  1  |
| 19+  |  0  |  0  |  1  |
| 20   |  0  |  0  |  1  |
| 20+  |  0  |  0  |  1  |
| 21   |  0  |  0  |  1  |
| 21+  |  0  |  0  |  1  |
| 22   |  0  |  0  |  1  |
| 22+  |  0  |  0  |  1  |
| 23   |  0  |  0  |  1  |
| 23+  |  0  |  0  |  1  |
| 24   |  0  |  0  |  1  |
| 24+  |  0  |  0  |  1  |
| 25   |  0  |  0  |  1  |
| 25+  |  0  |  0  |  1  |
| 26   |  0  |  0  |  1  |
| 26+  |  0  |  0  |  1  |
| 27   |  0  |  0  |  1  |
| 27+  |  0  |  0  |  1  |
| 28   |  0  |  0  |  1  |
| 28+  |  0  |  0  |  1  |
| 29   |  0  |  0  |  1  |
| 29+  |  0  |  0  |  1  |
| 30   |  0  |  0  |  1  |
| 30+  |  0  |  0  |  1  |
| 31   |  0  |  0  |  1  |
| 31+  |  0  |  0  |  1  |
| 32   |  0  |  0  |  1  |
| 32+  |  0  |  0  |  1  |
| 33   |  0  |  0  |  1  |
| 33+  |  0  |  0  |  1  |
| 34   |  0  |  0  |  1  |
| 34+  |  0  |  0  |  1  |
| 35   |  0  |  0  |  1  |
| 35+  |  0  |  0  |  1  |
| 36   |  0  |  0  |  1  |
| 36+  |  0  |  0  |  1  |
| 37   |  0  |  0  |  1  |
| 37+  |  0  |  0  |  1  |
| 38   |  0  |  0  |  1  |
| 38+  |  0  |  0  |  1  |
| 39   |  0  |  0  |  1  |
| 39+  |  0  |  0  |  1  |
| 40   |  0  |  0  |  1  |
| 40+  |  0  |  0  |  1  |
| 41   |  0  |  0  |  1  |
| 41+  |  0  |  0  |  1  |
| 42   |  0  |  0  |  1  |
| 42+  |  0  |  0  |  1  |
| 43   |  0  |  0  |  1  |
| 43+  |  0  |  0  |  1  |
| 44   |  0  |  0  |  1  |
| 44+  |  0  |  0  |  1  |
| 45   |  0  |  0  |  1  |
| 45+  |  0  |  0  |  1  |
| 46   |  0  |  0  |  1  |
| 46+  |  0  |  0  |  1  |
| 47   |  0  |  0  |  1  |
| 47+  |  0  |  0  |  1  |
| 48   |  0  |  0  |  1  |
| 48+  |  0  |  0  |  1  |
| 49   |  0  |  0  |  1  |
| 49+  |  0  |  0  |  1  |
| 50   |  0  |  0  |  1  |
| 50+  |  0  |  0  |  1  |
| 51   |  0  |  0  |  1  |
| 51+  |  0  |  0  |  1  |
| 52   |  0  |  0  |  1  |
| 52+  |  0  |  0  |  1  |
| 53   |  0  |  0  |  1  |
| 53+  |  0  |  0  |  1  |
| 54   |  0  |  0  |  1  |
| 54+  |  0  |  0  |  1  |
| 55   |  0  |  0  |  1  |
| 55+  |  0  |  0  |  1  |
| 56   |  0  |  0  |  1  |
| 56+  |  0  |  0  |  1  |
| 57   |  0  |  0  |  1  |
| 57+  |  0  |  1  |  1  |
| 58   |  0  |  1  |  0  |
| 58+  |  1  |  0  |  0  |
| 59   |  1  |  0  |  0  |
| 59+  |  1  |  0  |  0  |
| 60   |  1  |  0  |  0  |
| 60+  |  1  |  0  |  0  |
| 61   |  1  |  0  |  0  |
| 61+  |  1  |  0  |  0  |
| 62   |  1  |  0  |  0  |
| 62+  |  1  |  0  |  0  |
| 63   |  1  |  0  |  0  |
| 63+  |  1  |  0  |  0  |
| 64   |  1  |  0  |  0  |
| 64+  |  1  |  0  |  0  |
| 65   |  1  |  0  |  0  |
| 65+  |  1  |  0  |  0  |
| 66   |  1  |  0  |  0  |
| 66+  |  1  |  0  |  0  |
| 67   |  1  |  0  |  0  |
| 67+  |  1  |  0  |  0  |
| 68   |  1  |  0  |  0  |
| 68+  |  1  |  0  |  0  |
| 69   |  1  |  0  |  0  |
| 69+  |  1  |  0  |  0  |
| 70   |  1  |  0  |  0  |
| 70+  |  1  |  0  |  0  |
| 71   |  1  |  0  |  0  |
| 71+  |  1  |  0  |  0  |
| 72   |  1  |  0  |  0  |
| 72+  |  1  |  0  |  0  |
| 73   |  1  |  0  |  0  |
| 73+  |  1  |  0  |  0  |
| 74   |  1  |  0  |  0  |
| 74+  |  1  |  0  |  0  |
| 75   |  1  |  0  |  0  |
| 75+  |  1  |  0  |  0  |
| 76   |  1  |  0  |  0  |
| 76+  |  1  |  0  |  0  |
| 77   |  1  |  0  |  0  |
| 77+  |  1  |  0  |  0  |
| 78   |  1  |  0  |  0  |
| 78+  |  1  |  0  |  0  |
| 79   |  1  |  0  |  0  |
| 79+  |  1  |  0  |  0  |
| 80   |  1  |  0  |  0  |
| 80+  |  1  |  0  |  0  |
| 81   |  1  |  0  |  0  |
| 81+  |  1  |  0  |  0  |
| 82   |  1  |  0  |  0  |
| 82+  |  1  |  0  |  0  |
| 83   |  1  |  0  |  0  |
| 83+  |  1  |  0  |  0  |
| 84   |  1  |  0  |  0  |
| 84+  |  1  |  0  |  0  |
| 85   |  1  |  0  |  0  |
| 85+  |  1  |  0  |  0  |
| 86   |  1  |  0  |  0  |
| 86+  |  1  |  0  |  0  |
| 87   |  1  |  0  |  0  |
| 87+  |  1  |  0  |  0  |
| 88   |  1  |  0  |  0  |
| 88+  |  1  |  0  |  0  |
| 89   |  1  |  0  |  0  |
| 89+  |  1  |  0  |  0  |
| 90   |  1  |  0  |  0  |
| 90+  |  1  |  0  |  0  |
| 91   |  1  |  0  |  0  |
| 91+  |  1  |  0  |  0  |
| 92   |  1  |  0  |  0  |
| 92+  |  1  |  0  |  0  |
| 93   |  1  |  0  |  0  |
| 93+  |  1  |  0  |  0  |
| 94   |  1  |  0  |  0  |
| 94+  |  1  |  0  |  0  |
| 95   |  1  |  0  |  0  |
| 95+  |  1  |  0  |  0  |
| 96   |  1  |  0  |  0  |
| 96+  |  1  |  0  |  0  |
| 97   |  1  |  0  |  0  |
| 97+  |  1  |  0  |  0  |
| 98   |  1  |  0  |  0  |
| 98+  |  1  |  0  |  0  |
| 99   |  1  |  0  |  0  |
| 99+  |  1  |  0  |  0  |
| 100  |  1  |  0  |  0  |
| 100+ |  1  |  0  |  0  |
| 101  |  1  |  0  |  0  |
| 101+ |  1  |  0  |  0  |
| 102  |  1  |  0  |  0  |
| 102+ |  1  |  0  |  0  |
| 103  |  1  |  0  |  0  |
| 103+ |  1  |  0  |  0  |
| 104  |  1  |  0  |  0  |
| 104+ |  1  |  0  |  0  |
| 105  |  1  |  0  |  0  |
| 105+ |  1  |  0  |  0  |
| 106  |  1  |  0  |  0  |
| 106+ |  1  |  0  |  0  |
| 107  |  1  |  0  |  0  |
`)

export const Register = new ChipDef(`
CHIP Register {
  IN in[16], load;
  OUT out[16];

  PARTS:
  Bit(in=in[0], load=load, out=out[0]);
  Bit(in=in[1], load=load, out=out[1]);
  Bit(in=in[2], load=load, out=out[2]);
  Bit(in=in[3], load=load, out=out[3]);
  Bit(in=in[4], load=load, out=out[4]);
  Bit(in=in[5], load=load, out=out[5]);
  Bit(in=in[6], load=load, out=out[6]);
  Bit(in=in[7], load=load, out=out[7]);
  Bit(in=in[8], load=load, out=out[8]);
  Bit(in=in[9], load=load, out=out[9]);
  Bit(in=in[10], load=load, out=out[10]);
  Bit(in=in[11], load=load, out=out[11]);
  Bit(in=in[12], load=load, out=out[12]);
  Bit(in=in[13], load=load, out=out[13]);
  Bit(in=in[14], load=load, out=out[14]);
  Bit(in=in[15], load=load, out=out[15]);
}`).test(`
| time |   in   |load |  out   |
| 0+   |      0 |  0  |      0 |
| 1    |      0 |  0  |      0 |
| 1+   |      0 |  1  |      0 |
| 2    |      0 |  1  |      0 |
| 2+   | -32123 |  0  |      0 |
| 3    | -32123 |  0  |      0 |
| 3+   |  11111 |  0  |      0 |
| 4    |  11111 |  0  |      0 |
| 4+   | -32123 |  1  |      0 |
| 5    | -32123 |  1  | -32123 |
| 5+   | -32123 |  1  | -32123 |
| 6    | -32123 |  1  | -32123 |
| 6+   | -32123 |  0  | -32123 |
| 7    | -32123 |  0  | -32123 |
| 7+   |  12345 |  1  | -32123 |
| 8    |  12345 |  1  |  12345 |
| 8+   |      0 |  0  |  12345 |
| 9    |      0 |  0  |  12345 |
| 9+   |      0 |  1  |  12345 |
| 10   |      0 |  1  |      0 |
| 10+  |      1 |  0  |      0 |
| 11   |      1 |  0  |      0 |
| 11+  |      1 |  1  |      0 |
| 12   |      1 |  1  |      1 |
| 12+  |      2 |  0  |      1 |
| 13   |      2 |  0  |      1 |
| 13+  |      2 |  1  |      1 |
| 14   |      2 |  1  |      2 |
| 14+  |      4 |  0  |      2 |
| 15   |      4 |  0  |      2 |
| 15+  |      4 |  1  |      2 |
| 16   |      4 |  1  |      4 |
| 16+  |      8 |  0  |      4 |
| 17   |      8 |  0  |      4 |
| 17+  |      8 |  1  |      4 |
| 18   |      8 |  1  |      8 |
| 18+  |     16 |  0  |      8 |
| 19   |     16 |  0  |      8 |
| 19+  |     16 |  1  |      8 |
| 20   |     16 |  1  |     16 |
| 20+  |     32 |  0  |     16 |
| 21   |     32 |  0  |     16 |
| 21+  |     32 |  1  |     16 |
| 22   |     32 |  1  |     32 |
| 22+  |     64 |  0  |     32 |
| 23   |     64 |  0  |     32 |
| 23+  |     64 |  1  |     32 |
| 24   |     64 |  1  |     64 |
| 24+  |    128 |  0  |     64 |
| 25   |    128 |  0  |     64 |
| 25+  |    128 |  1  |     64 |
| 26   |    128 |  1  |    128 |
| 26+  |    256 |  0  |    128 |
| 27   |    256 |  0  |    128 |
| 27+  |    256 |  1  |    128 |
| 28   |    256 |  1  |    256 |
| 28+  |    512 |  0  |    256 |
| 29   |    512 |  0  |    256 |
| 29+  |    512 |  1  |    256 |
| 30   |    512 |  1  |    512 |
| 30+  |   1024 |  0  |    512 |
| 31   |   1024 |  0  |    512 |
| 31+  |   1024 |  1  |    512 |
| 32   |   1024 |  1  |   1024 |
| 32+  |   2048 |  0  |   1024 |
| 33   |   2048 |  0  |   1024 |
| 33+  |   2048 |  1  |   1024 |
| 34   |   2048 |  1  |   2048 |
| 34+  |   4096 |  0  |   2048 |
| 35   |   4096 |  0  |   2048 |
| 35+  |   4096 |  1  |   2048 |
| 36   |   4096 |  1  |   4096 |
| 36+  |   8192 |  0  |   4096 |
| 37   |   8192 |  0  |   4096 |
| 37+  |   8192 |  1  |   4096 |
| 38   |   8192 |  1  |   8192 |
| 38+  |  16384 |  0  |   8192 |
| 39   |  16384 |  0  |   8192 |
| 39+  |  16384 |  1  |   8192 |
| 40   |  16384 |  1  |  16384 |
| 40+  | -32768 |  0  |  16384 |
| 41   | -32768 |  0  |  16384 |
| 41+  | -32768 |  1  |  16384 |
| 42   | -32768 |  1  | -32768 |
| 42+  |     -2 |  0  | -32768 |
| 43   |     -2 |  0  | -32768 |
| 43+  |     -2 |  1  | -32768 |
| 44   |     -2 |  1  |     -2 |
| 44+  |     -3 |  0  |     -2 |
| 45   |     -3 |  0  |     -2 |
| 45+  |     -3 |  1  |     -2 |
| 46   |     -3 |  1  |     -3 |
| 46+  |     -5 |  0  |     -3 |
| 47   |     -5 |  0  |     -3 |
| 47+  |     -5 |  1  |     -3 |
| 48   |     -5 |  1  |     -5 |
| 48+  |     -9 |  0  |     -5 |
| 49   |     -9 |  0  |     -5 |
| 49+  |     -9 |  1  |     -5 |
| 50   |     -9 |  1  |     -9 |
| 50+  |    -17 |  0  |     -9 |
| 51   |    -17 |  0  |     -9 |
| 51+  |    -17 |  1  |     -9 |
| 52   |    -17 |  1  |    -17 |
| 52+  |    -33 |  0  |    -17 |
| 53   |    -33 |  0  |    -17 |
| 53+  |    -33 |  1  |    -17 |
| 54   |    -33 |  1  |    -33 |
| 54+  |    -65 |  0  |    -33 |
| 55   |    -65 |  0  |    -33 |
| 55+  |    -65 |  1  |    -33 |
| 56   |    -65 |  1  |    -65 |
| 56+  |   -129 |  0  |    -65 |
| 57   |   -129 |  0  |    -65 |
| 57+  |   -129 |  1  |    -65 |
| 58   |   -129 |  1  |   -129 |
| 58+  |   -257 |  0  |   -129 |
| 59   |   -257 |  0  |   -129 |
| 59+  |   -257 |  1  |   -129 |
| 60   |   -257 |  1  |   -257 |
| 60+  |   -513 |  0  |   -257 |
| 61   |   -513 |  0  |   -257 |
| 61+  |   -513 |  1  |   -257 |
| 62   |   -513 |  1  |   -513 |
| 62+  |  -1025 |  0  |   -513 |
| 63   |  -1025 |  0  |   -513 |
| 63+  |  -1025 |  1  |   -513 |
| 64   |  -1025 |  1  |  -1025 |
| 64+  |  -2049 |  0  |  -1025 |
| 65   |  -2049 |  0  |  -1025 |
| 65+  |  -2049 |  1  |  -1025 |
| 66   |  -2049 |  1  |  -2049 |
| 66+  |  -4097 |  0  |  -2049 |
| 67   |  -4097 |  0  |  -2049 |
| 67+  |  -4097 |  1  |  -2049 |
| 68   |  -4097 |  1  |  -4097 |
| 68+  |  -8193 |  0  |  -4097 |
| 69   |  -8193 |  0  |  -4097 |
| 69+  |  -8193 |  1  |  -4097 |
| 70   |  -8193 |  1  |  -8193 |
| 70+  | -16385 |  0  |  -8193 |
| 71   | -16385 |  0  |  -8193 |
| 71+  | -16385 |  1  |  -8193 |
| 72   | -16385 |  1  | -16385 |
| 72+  |  32767 |  0  | -16385 |
| 73   |  32767 |  0  | -16385 |
| 73+  |  32767 |  1  | -16385 |
| 74   |  32767 |  1  |  32767 |
`)

/*

export const RAM8 = new ChipDef(`
CHIP RAM8 {
  IN load, address[3], in[16];
  OUT out[16];
  
  PARTS:
  DMux8Way(sel=address, in=load, a=la, b=lb, c=lc, d=ld, e=le, f=lf, g=lg, h=lh);
  Register(in=in, load=la, out=a);
  Register(in=in, load=lb, out=b);
  Register(in=in, load=lc, out=c);
  Register(in=in, load=ld, out=d);
  Register(in=in, load=le, out=e);
  Register(in=in, load=lf, out=f);
  Register(in=in, load=lg, out=g);
  Register(in=in, load=lh, out=h);
  Mux8Way16(sel=address, a=a, b=b, c=c, d=d, e=e, f=f, g=g, h=h, out=out);
}
`).test(`
| time |   in   |load |address|  out   |
| 0+   |      0 |  0  |   0   |      0 |
| 1    |      0 |  0  |   0   |      0 |
| 1+   |      0 |  1  |   0   |      0 |
| 2    |      0 |  1  |   0   |      0 |
| 2+   |  11111 |  0  |   0   |      0 |
| 3    |  11111 |  0  |   0   |      0 |
| 3+   |  11111 |  1  |   1   |      0 |
| 4    |  11111 |  1  |   1   |  11111 |
| 4+   |  11111 |  0  |   0   |      0 |
| 5    |  11111 |  0  |   0   |      0 |
| 5+   |   3333 |  0  |   3   |      0 |
| 6    |   3333 |  0  |   3   |      0 |
| 6+   |   3333 |  1  |   3   |      0 |
| 7    |   3333 |  1  |   3   |   3333 |
| 7+   |   3333 |  0  |   3   |   3333 |
| 8    |   3333 |  0  |   3   |   3333 |
| 8    |   3333 |  0  |   1   |  11111 |
| 8+   |   7777 |  0  |   1   |  11111 |
| 9    |   7777 |  0  |   1   |  11111 |
| 9+   |   7777 |  1  |   7   |      0 |
| 10   |   7777 |  1  |   7   |   7777 |
| 10+  |   7777 |  0  |   7   |   7777 |
| 11   |   7777 |  0  |   7   |   7777 |
| 11   |   7777 |  0  |   3   |   3333 |
| 11   |   7777 |  0  |   7   |   7777 |
| 11+  |   7777 |  0  |   0   |      0 |
| 12   |   7777 |  0  |   0   |      0 |
| 12   |   7777 |  0  |   1   |  11111 |
| 12   |   7777 |  0  |   2   |      0 |
| 12   |   7777 |  0  |   3   |   3333 |
| 12   |   7777 |  0  |   4   |      0 |
| 12   |   7777 |  0  |   5   |      0 |
| 12   |   7777 |  0  |   6   |      0 |
| 12   |   7777 |  0  |   7   |   7777 |
| 12+  |  21845 |  1  |   0   |      0 |
| 13   |  21845 |  1  |   0   |  21845 |
| 13+  |  21845 |  1  |   1   |  11111 |
| 14   |  21845 |  1  |   1   |  21845 |
| 14+  |  21845 |  1  |   2   |      0 |
| 15   |  21845 |  1  |   2   |  21845 |
| 15+  |  21845 |  1  |   3   |   3333 |
| 16   |  21845 |  1  |   3   |  21845 |
| 16+  |  21845 |  1  |   4   |      0 |
| 17   |  21845 |  1  |   4   |  21845 |
| 17+  |  21845 |  1  |   5   |      0 |
| 18   |  21845 |  1  |   5   |  21845 |
| 18+  |  21845 |  1  |   6   |      0 |
| 19   |  21845 |  1  |   6   |  21845 |
| 19+  |  21845 |  1  |   7   |   7777 |
| 20   |  21845 |  1  |   7   |  21845 |
| 20+  |  21845 |  0  |   0   |  21845 |
| 21   |  21845 |  0  |   0   |  21845 |
| 21   |  21845 |  0  |   1   |  21845 |
| 21   |  21845 |  0  |   2   |  21845 |
| 21   |  21845 |  0  |   3   |  21845 |
| 21   |  21845 |  0  |   4   |  21845 |
| 21   |  21845 |  0  |   5   |  21845 |
| 21   |  21845 |  0  |   6   |  21845 |
| 21   |  21845 |  0  |   7   |  21845 |
| 21+  | -21846 |  1  |   0   |  21845 |
| 22   | -21846 |  1  |   0   | -21846 |
| 22+  | -21846 |  0  |   0   | -21846 |
| 23   | -21846 |  0  |   0   | -21846 |
| 23   | -21846 |  0  |   1   |  21845 |
| 23   | -21846 |  0  |   2   |  21845 |
| 23   | -21846 |  0  |   3   |  21845 |
| 23   | -21846 |  0  |   4   |  21845 |
| 23   | -21846 |  0  |   5   |  21845 |
| 23   | -21846 |  0  |   6   |  21845 |
| 23   | -21846 |  0  |   7   |  21845 |
| 23+  |  21845 |  1  |   0   | -21846 |
| 24   |  21845 |  1  |   0   |  21845 |
| 24+  | -21846 |  1  |   1   |  21845 |
| 25   | -21846 |  1  |   1   | -21846 |
| 25+  | -21846 |  0  |   0   |  21845 |
| 26   | -21846 |  0  |   0   |  21845 |
| 26   | -21846 |  0  |   1   | -21846 |
| 26   | -21846 |  0  |   2   |  21845 |
| 26   | -21846 |  0  |   3   |  21845 |
| 26   | -21846 |  0  |   4   |  21845 |
| 26   | -21846 |  0  |   5   |  21845 |
| 26   | -21846 |  0  |   6   |  21845 |
| 26   | -21846 |  0  |   7   |  21845 |
| 26+  |  21845 |  1  |   1   | -21846 |
| 27   |  21845 |  1  |   1   |  21845 |
| 27+  | -21846 |  1  |   2   |  21845 |
| 28   | -21846 |  1  |   2   | -21846 |
| 28+  | -21846 |  0  |   0   |  21845 |
| 29   | -21846 |  0  |   0   |  21845 |
| 29   | -21846 |  0  |   1   |  21845 |
| 29   | -21846 |  0  |   2   | -21846 |
| 29   | -21846 |  0  |   3   |  21845 |
| 29   | -21846 |  0  |   4   |  21845 |
| 29   | -21846 |  0  |   5   |  21845 |
| 29   | -21846 |  0  |   6   |  21845 |
| 29   | -21846 |  0  |   7   |  21845 |
| 29+  |  21845 |  1  |   2   | -21846 |
| 30   |  21845 |  1  |   2   |  21845 |
| 30+  | -21846 |  1  |   3   |  21845 |
| 31   | -21846 |  1  |   3   | -21846 |
| 31+  | -21846 |  0  |   0   |  21845 |
| 32   | -21846 |  0  |   0   |  21845 |
| 32   | -21846 |  0  |   1   |  21845 |
| 32   | -21846 |  0  |   2   |  21845 |
| 32   | -21846 |  0  |   3   | -21846 |
| 32   | -21846 |  0  |   4   |  21845 |
| 32   | -21846 |  0  |   5   |  21845 |
| 32   | -21846 |  0  |   6   |  21845 |
| 32   | -21846 |  0  |   7   |  21845 |
| 32+  |  21845 |  1  |   3   | -21846 |
| 33   |  21845 |  1  |   3   |  21845 |
| 33+  | -21846 |  1  |   4   |  21845 |
| 34   | -21846 |  1  |   4   | -21846 |
| 34+  | -21846 |  0  |   0   |  21845 |
| 35   | -21846 |  0  |   0   |  21845 |
| 35   | -21846 |  0  |   1   |  21845 |
| 35   | -21846 |  0  |   2   |  21845 |
| 35   | -21846 |  0  |   3   |  21845 |
| 35   | -21846 |  0  |   4   | -21846 |
| 35   | -21846 |  0  |   5   |  21845 |
| 35   | -21846 |  0  |   6   |  21845 |
| 35   | -21846 |  0  |   7   |  21845 |
| 35+  |  21845 |  1  |   4   | -21846 |
| 36   |  21845 |  1  |   4   |  21845 |
| 36+  | -21846 |  1  |   5   |  21845 |
| 37   | -21846 |  1  |   5   | -21846 |
| 37+  | -21846 |  0  |   0   |  21845 |
| 38   | -21846 |  0  |   0   |  21845 |
| 38   | -21846 |  0  |   1   |  21845 |
| 38   | -21846 |  0  |   2   |  21845 |
| 38   | -21846 |  0  |   3   |  21845 |
| 38   | -21846 |  0  |   4   |  21845 |
| 38   | -21846 |  0  |   5   | -21846 |
| 38   | -21846 |  0  |   6   |  21845 |
| 38   | -21846 |  0  |   7   |  21845 |
| 38+  |  21845 |  1  |   5   | -21846 |
| 39   |  21845 |  1  |   5   |  21845 |
| 39+  | -21846 |  1  |   6   |  21845 |
| 40   | -21846 |  1  |   6   | -21846 |
| 40+  | -21846 |  0  |   0   |  21845 |
| 41   | -21846 |  0  |   0   |  21845 |
| 41   | -21846 |  0  |   1   |  21845 |
| 41   | -21846 |  0  |   2   |  21845 |
| 41   | -21846 |  0  |   3   |  21845 |
| 41   | -21846 |  0  |   4   |  21845 |
| 41   | -21846 |  0  |   5   |  21845 |
| 41   | -21846 |  0  |   6   | -21846 |
| 41   | -21846 |  0  |   7   |  21845 |
| 41+  |  21845 |  1  |   6   | -21846 |
| 42   |  21845 |  1  |   6   |  21845 |
| 42+  | -21846 |  1  |   7   |  21845 |
| 43   | -21846 |  1  |   7   | -21846 |
| 43+  | -21846 |  0  |   0   |  21845 |
| 44   | -21846 |  0  |   0   |  21845 |
| 44   | -21846 |  0  |   1   |  21845 |
| 44   | -21846 |  0  |   2   |  21845 |
| 44   | -21846 |  0  |   3   |  21845 |
| 44   | -21846 |  0  |   4   |  21845 |
| 44   | -21846 |  0  |   5   |  21845 |
| 44   | -21846 |  0  |   6   |  21845 |
| 44   | -21846 |  0  |   7   | -21846 |
| 44+  |  21845 |  1  |   7   | -21846 |
| 45   |  21845 |  1  |   7   |  21845 |
| 45+  |  21845 |  0  |   0   |  21845 |
| 46   |  21845 |  0  |   0   |  21845 |
| 46   |  21845 |  0  |   1   |  21845 |
| 46   |  21845 |  0  |   2   |  21845 |
| 46   |  21845 |  0  |   3   |  21845 |
| 46   |  21845 |  0  |   4   |  21845 |
| 46   |  21845 |  0  |   5   |  21845 |
| 46   |  21845 |  0  |   6   |  21845 |
| 46   |  21845 |  0  |   7   |  21845 |
`)

export const RAM64 = new ChipDef(`
CHIP RAM64 {
  IN load, address[6], in[16];
  OUT out[16];
  
  PARTS:
  DMux8Way(sel=address[0..2], in=load, a=la, b=lb, c=lc, d=ld, e=le, f=lf, g=lg, h=lh);
  RAM8(in=in, load=la, address=address[3..5], out=a);
  RAM8(in=in, load=lb, address=address[3..5], out=b);
  RAM8(in=in, load=lc, address=address[3..5], out=c);
  RAM8(in=in, load=ld, address=address[3..5], out=d);
  RAM8(in=in, load=le, address=address[3..5], out=e);
  RAM8(in=in, load=lf, address=address[3..5], out=f);
  RAM8(in=in, load=lg, address=address[3..5], out=g);
  RAM8(in=in, load=lh, address=address[3..5], out=h);
  Mux8Way16(sel=address[0..2], a=a, b=b, c=c, d=d, e=e, f=f, g=g, h=h, out=out);
}
`).test(`
| time |   in   |load |address|  out   |
| 0+   |      0 |  0  |    0  |      0 |
| 1    |      0 |  0  |    0  |      0 |
| 1+   |      0 |  1  |    0  |      0 |
| 2    |      0 |  1  |    0  |      0 |
| 2+   |   1313 |  0  |    0  |      0 |
| 3    |   1313 |  0  |    0  |      0 |
| 3+   |   1313 |  1  |   13  |      0 |
| 4    |   1313 |  1  |   13  |   1313 |
| 4+   |   1313 |  0  |    0  |      0 |
| 5    |   1313 |  0  |    0  |      0 |
| 5+   |   4747 |  0  |   47  |      0 |
| 6    |   4747 |  0  |   47  |      0 |
| 6+   |   4747 |  1  |   47  |      0 |
| 7    |   4747 |  1  |   47  |   4747 |
| 7+   |   4747 |  0  |   47  |   4747 |
| 8    |   4747 |  0  |   47  |   4747 |
| 8    |   4747 |  0  |   13  |   1313 |
| 8+   |   6363 |  0  |   13  |   1313 |
| 9    |   6363 |  0  |   13  |   1313 |
| 9+   |   6363 |  1  |   63  |      0 |
| 10   |   6363 |  1  |   63  |   6363 |
| 10+  |   6363 |  0  |   63  |   6363 |
| 11   |   6363 |  0  |   63  |   6363 |
| 11   |   6363 |  0  |   47  |   4747 |
| 11   |   6363 |  0  |   63  |   6363 |
| 11+  |   6363 |  0  |   40  |      0 |
| 12   |   6363 |  0  |   40  |      0 |
| 12   |   6363 |  0  |   41  |      0 |
| 12   |   6363 |  0  |   42  |      0 |
| 12   |   6363 |  0  |   43  |      0 |
| 12   |   6363 |  0  |   44  |      0 |
| 12   |   6363 |  0  |   45  |      0 |
| 12   |   6363 |  0  |   46  |      0 |
| 12   |   6363 |  0  |   47  |   4747 |
| 12+  |  21845 |  1  |   40  |      0 |
| 13   |  21845 |  1  |   40  |  21845 |
| 13+  |  21845 |  1  |   41  |      0 |
| 14   |  21845 |  1  |   41  |  21845 |
| 14+  |  21845 |  1  |   42  |      0 |
| 15   |  21845 |  1  |   42  |  21845 |
| 15+  |  21845 |  1  |   43  |      0 |
| 16   |  21845 |  1  |   43  |  21845 |
| 16+  |  21845 |  1  |   44  |      0 |
| 17   |  21845 |  1  |   44  |  21845 |
| 17+  |  21845 |  1  |   45  |      0 |
| 18   |  21845 |  1  |   45  |  21845 |
| 18+  |  21845 |  1  |   46  |      0 |
| 19   |  21845 |  1  |   46  |  21845 |
| 19+  |  21845 |  1  |   47  |   4747 |
| 20   |  21845 |  1  |   47  |  21845 |
| 20+  |  21845 |  0  |   40  |  21845 |
| 21   |  21845 |  0  |   40  |  21845 |
| 21   |  21845 |  0  |   41  |  21845 |
| 21   |  21845 |  0  |   42  |  21845 |
| 21   |  21845 |  0  |   43  |  21845 |
| 21   |  21845 |  0  |   44  |  21845 |
| 21   |  21845 |  0  |   45  |  21845 |
| 21   |  21845 |  0  |   46  |  21845 |
| 21   |  21845 |  0  |   47  |  21845 |
| 21+  | -21846 |  1  |   40  |  21845 |
| 22   | -21846 |  1  |   40  | -21846 |
| 22+  | -21846 |  0  |   40  | -21846 |
| 23   | -21846 |  0  |   40  | -21846 |
| 23   | -21846 |  0  |   41  |  21845 |
| 23   | -21846 |  0  |   42  |  21845 |
| 23   | -21846 |  0  |   43  |  21845 |
| 23   | -21846 |  0  |   44  |  21845 |
| 23   | -21846 |  0  |   45  |  21845 |
| 23   | -21846 |  0  |   46  |  21845 |
| 23   | -21846 |  0  |   47  |  21845 |
| 23+  |  21845 |  1  |   40  | -21846 |
| 24   |  21845 |  1  |   40  |  21845 |
| 24+  | -21846 |  1  |   41  |  21845 |
| 25   | -21846 |  1  |   41  | -21846 |
| 25+  | -21846 |  0  |   40  |  21845 |
| 26   | -21846 |  0  |   40  |  21845 |
| 26   | -21846 |  0  |   41  | -21846 |
| 26   | -21846 |  0  |   42  |  21845 |
| 26   | -21846 |  0  |   43  |  21845 |
| 26   | -21846 |  0  |   44  |  21845 |
| 26   | -21846 |  0  |   45  |  21845 |
| 26   | -21846 |  0  |   46  |  21845 |
| 26   | -21846 |  0  |   47  |  21845 |
| 26+  |  21845 |  1  |   41  | -21846 |
| 27   |  21845 |  1  |   41  |  21845 |
| 27+  | -21846 |  1  |   42  |  21845 |
| 28   | -21846 |  1  |   42  | -21846 |
| 28+  | -21846 |  0  |   40  |  21845 |
| 29   | -21846 |  0  |   40  |  21845 |
| 29   | -21846 |  0  |   41  |  21845 |
| 29   | -21846 |  0  |   42  | -21846 |
| 29   | -21846 |  0  |   43  |  21845 |
| 29   | -21846 |  0  |   44  |  21845 |
| 29   | -21846 |  0  |   45  |  21845 |
| 29   | -21846 |  0  |   46  |  21845 |
| 29   | -21846 |  0  |   47  |  21845 |
| 29+  |  21845 |  1  |   42  | -21846 |
| 30   |  21845 |  1  |   42  |  21845 |
| 30+  | -21846 |  1  |   43  |  21845 |
| 31   | -21846 |  1  |   43  | -21846 |
| 31+  | -21846 |  0  |   40  |  21845 |
| 32   | -21846 |  0  |   40  |  21845 |
| 32   | -21846 |  0  |   41  |  21845 |
| 32   | -21846 |  0  |   42  |  21845 |
| 32   | -21846 |  0  |   43  | -21846 |
| 32   | -21846 |  0  |   44  |  21845 |
| 32   | -21846 |  0  |   45  |  21845 |
| 32   | -21846 |  0  |   46  |  21845 |
| 32   | -21846 |  0  |   47  |  21845 |
| 32+  |  21845 |  1  |   43  | -21846 |
| 33   |  21845 |  1  |   43  |  21845 |
| 33+  | -21846 |  1  |   44  |  21845 |
| 34   | -21846 |  1  |   44  | -21846 |
| 34+  | -21846 |  0  |   40  |  21845 |
| 35   | -21846 |  0  |   40  |  21845 |
| 35   | -21846 |  0  |   41  |  21845 |
| 35   | -21846 |  0  |   42  |  21845 |
| 35   | -21846 |  0  |   43  |  21845 |
| 35   | -21846 |  0  |   44  | -21846 |
| 35   | -21846 |  0  |   45  |  21845 |
| 35   | -21846 |  0  |   46  |  21845 |
| 35   | -21846 |  0  |   47  |  21845 |
| 35+  |  21845 |  1  |   44  | -21846 |
| 36   |  21845 |  1  |   44  |  21845 |
| 36+  | -21846 |  1  |   45  |  21845 |
| 37   | -21846 |  1  |   45  | -21846 |
| 37+  | -21846 |  0  |   40  |  21845 |
| 38   | -21846 |  0  |   40  |  21845 |
| 38   | -21846 |  0  |   41  |  21845 |
| 38   | -21846 |  0  |   42  |  21845 |
| 38   | -21846 |  0  |   43  |  21845 |
| 38   | -21846 |  0  |   44  |  21845 |
| 38   | -21846 |  0  |   45  | -21846 |
| 38   | -21846 |  0  |   46  |  21845 |
| 38   | -21846 |  0  |   47  |  21845 |
| 38+  |  21845 |  1  |   45  | -21846 |
| 39   |  21845 |  1  |   45  |  21845 |
| 39+  | -21846 |  1  |   46  |  21845 |
| 40   | -21846 |  1  |   46  | -21846 |
| 40+  | -21846 |  0  |   40  |  21845 |
| 41   | -21846 |  0  |   40  |  21845 |
| 41   | -21846 |  0  |   41  |  21845 |
| 41   | -21846 |  0  |   42  |  21845 |
| 41   | -21846 |  0  |   43  |  21845 |
| 41   | -21846 |  0  |   44  |  21845 |
| 41   | -21846 |  0  |   45  |  21845 |
| 41   | -21846 |  0  |   46  | -21846 |
| 41   | -21846 |  0  |   47  |  21845 |
| 41+  |  21845 |  1  |   46  | -21846 |
| 42   |  21845 |  1  |   46  |  21845 |
| 42+  | -21846 |  1  |   47  |  21845 |
| 43   | -21846 |  1  |   47  | -21846 |
| 43+  | -21846 |  0  |   40  |  21845 |
| 44   | -21846 |  0  |   40  |  21845 |
| 44   | -21846 |  0  |   41  |  21845 |
| 44   | -21846 |  0  |   42  |  21845 |
| 44   | -21846 |  0  |   43  |  21845 |
| 44   | -21846 |  0  |   44  |  21845 |
| 44   | -21846 |  0  |   45  |  21845 |
| 44   | -21846 |  0  |   46  |  21845 |
| 44   | -21846 |  0  |   47  | -21846 |
| 44+  |  21845 |  1  |   47  | -21846 |
| 45   |  21845 |  1  |   47  |  21845 |
| 45+  |  21845 |  0  |   40  |  21845 |
| 46   |  21845 |  0  |   40  |  21845 |
| 46   |  21845 |  0  |   41  |  21845 |
| 46   |  21845 |  0  |   42  |  21845 |
| 46   |  21845 |  0  |   43  |  21845 |
| 46   |  21845 |  0  |   44  |  21845 |
| 46   |  21845 |  0  |   45  |  21845 |
| 46   |  21845 |  0  |   46  |  21845 |
| 46   |  21845 |  0  |   47  |  21845 |
| 46+  |  21845 |  0  |    5  |      0 |
| 47   |  21845 |  0  |    5  |      0 |
| 47   |  21845 |  0  |   13  |   1313 |
| 47   |  21845 |  0  |   21  |      0 |
| 47   |  21845 |  0  |   29  |      0 |
| 47   |  21845 |  0  |   37  |      0 |
| 47   |  21845 |  0  |   45  |  21845 |
| 47   |  21845 |  0  |   53  |      0 |
| 47   |  21845 |  0  |   61  |      0 |
| 47+  |  21845 |  1  |    5  |      0 |
| 48   |  21845 |  1  |    5  |  21845 |
| 48+  |  21845 |  1  |   13  |   1313 |
| 49   |  21845 |  1  |   13  |  21845 |
| 49+  |  21845 |  1  |   21  |      0 |
| 50   |  21845 |  1  |   21  |  21845 |
| 50+  |  21845 |  1  |   29  |      0 |
| 51   |  21845 |  1  |   29  |  21845 |
| 51+  |  21845 |  1  |   37  |      0 |
| 52   |  21845 |  1  |   37  |  21845 |
| 52+  |  21845 |  1  |   45  |  21845 |
| 53   |  21845 |  1  |   45  |  21845 |
| 53+  |  21845 |  1  |   53  |      0 |
| 54   |  21845 |  1  |   53  |  21845 |
| 54+  |  21845 |  1  |   61  |      0 |
| 55   |  21845 |  1  |   61  |  21845 |
| 55+  |  21845 |  0  |    5  |  21845 |
| 56   |  21845 |  0  |    5  |  21845 |
| 56   |  21845 |  0  |   13  |  21845 |
| 56   |  21845 |  0  |   21  |  21845 |
| 56   |  21845 |  0  |   29  |  21845 |
| 56   |  21845 |  0  |   37  |  21845 |
| 56   |  21845 |  0  |   45  |  21845 |
| 56   |  21845 |  0  |   53  |  21845 |
| 56   |  21845 |  0  |   61  |  21845 |
| 56+  | -21846 |  1  |    5  |  21845 |
| 57   | -21846 |  1  |    5  | -21846 |
| 57+  | -21846 |  0  |    5  | -21846 |
| 58   | -21846 |  0  |    5  | -21846 |
| 58   | -21846 |  0  |   13  |  21845 |
| 58   | -21846 |  0  |   21  |  21845 |
| 58   | -21846 |  0  |   29  |  21845 |
| 58   | -21846 |  0  |   37  |  21845 |
| 58   | -21846 |  0  |   45  |  21845 |
| 58   | -21846 |  0  |   53  |  21845 |
| 58   | -21846 |  0  |   61  |  21845 |
| 58+  |  21845 |  1  |    5  | -21846 |
| 59   |  21845 |  1  |    5  |  21845 |
| 59+  | -21846 |  1  |   13  |  21845 |
| 60   | -21846 |  1  |   13  | -21846 |
| 60+  | -21846 |  0  |    5  |  21845 |
| 61   | -21846 |  0  |    5  |  21845 |
| 61   | -21846 |  0  |   13  | -21846 |
| 61   | -21846 |  0  |   21  |  21845 |
| 61   | -21846 |  0  |   29  |  21845 |
| 61   | -21846 |  0  |   37  |  21845 |
| 61   | -21846 |  0  |   45  |  21845 |
| 61   | -21846 |  0  |   53  |  21845 |
| 61   | -21846 |  0  |   61  |  21845 |
| 61+  |  21845 |  1  |   13  | -21846 |
| 62   |  21845 |  1  |   13  |  21845 |
| 62+  | -21846 |  1  |   21  |  21845 |
| 63   | -21846 |  1  |   21  | -21846 |
| 63+  | -21846 |  0  |    5  |  21845 |
| 64   | -21846 |  0  |    5  |  21845 |
| 64   | -21846 |  0  |   13  |  21845 |
| 64   | -21846 |  0  |   21  | -21846 |
| 64   | -21846 |  0  |   29  |  21845 |
| 64   | -21846 |  0  |   37  |  21845 |
| 64   | -21846 |  0  |   45  |  21845 |
| 64   | -21846 |  0  |   53  |  21845 |
| 64   | -21846 |  0  |   61  |  21845 |
| 64+  |  21845 |  1  |   21  | -21846 |
| 65   |  21845 |  1  |   21  |  21845 |
| 65+  | -21846 |  1  |   29  |  21845 |
| 66   | -21846 |  1  |   29  | -21846 |
| 66+  | -21846 |  0  |    5  |  21845 |
| 67   | -21846 |  0  |    5  |  21845 |
| 67   | -21846 |  0  |   13  |  21845 |
| 67   | -21846 |  0  |   21  |  21845 |
| 67   | -21846 |  0  |   29  | -21846 |
| 67   | -21846 |  0  |   37  |  21845 |
| 67   | -21846 |  0  |   45  |  21845 |
| 67   | -21846 |  0  |   53  |  21845 |
| 67   | -21846 |  0  |   61  |  21845 |
| 67+  |  21845 |  1  |   29  | -21846 |
| 68   |  21845 |  1  |   29  |  21845 |
| 68+  | -21846 |  1  |   37  |  21845 |
| 69   | -21846 |  1  |   37  | -21846 |
| 69+  | -21846 |  0  |    5  |  21845 |
| 70   | -21846 |  0  |    5  |  21845 |
| 70   | -21846 |  0  |   13  |  21845 |
| 70   | -21846 |  0  |   21  |  21845 |
| 70   | -21846 |  0  |   29  |  21845 |
| 70   | -21846 |  0  |   37  | -21846 |
| 70   | -21846 |  0  |   45  |  21845 |
| 70   | -21846 |  0  |   53  |  21845 |
| 70   | -21846 |  0  |   61  |  21845 |
| 70+  |  21845 |  1  |   37  | -21846 |
| 71   |  21845 |  1  |   37  |  21845 |
| 71+  | -21846 |  1  |   45  |  21845 |
| 72   | -21846 |  1  |   45  | -21846 |
| 72+  | -21846 |  0  |    5  |  21845 |
| 73   | -21846 |  0  |    5  |  21845 |
| 73   | -21846 |  0  |   13  |  21845 |
| 73   | -21846 |  0  |   21  |  21845 |
| 73   | -21846 |  0  |   29  |  21845 |
| 73   | -21846 |  0  |   37  |  21845 |
| 73   | -21846 |  0  |   45  | -21846 |
| 73   | -21846 |  0  |   53  |  21845 |
| 73   | -21846 |  0  |   61  |  21845 |
| 73+  |  21845 |  1  |   45  | -21846 |
| 74   |  21845 |  1  |   45  |  21845 |
| 74+  | -21846 |  1  |   53  |  21845 |
| 75   | -21846 |  1  |   53  | -21846 |
| 75+  | -21846 |  0  |    5  |  21845 |
| 76   | -21846 |  0  |    5  |  21845 |
| 76   | -21846 |  0  |   13  |  21845 |
| 76   | -21846 |  0  |   21  |  21845 |
| 76   | -21846 |  0  |   29  |  21845 |
| 76   | -21846 |  0  |   37  |  21845 |
| 76   | -21846 |  0  |   45  |  21845 |
| 76   | -21846 |  0  |   53  | -21846 |
| 76   | -21846 |  0  |   61  |  21845 |
| 76+  |  21845 |  1  |   53  | -21846 |
| 77   |  21845 |  1  |   53  |  21845 |
| 77+  | -21846 |  1  |   61  |  21845 |
| 78   | -21846 |  1  |   61  | -21846 |
| 78+  | -21846 |  0  |    5  |  21845 |
| 79   | -21846 |  0  |    5  |  21845 |
| 79   | -21846 |  0  |   13  |  21845 |
| 79   | -21846 |  0  |   21  |  21845 |
| 79   | -21846 |  0  |   29  |  21845 |
| 79   | -21846 |  0  |   37  |  21845 |
| 79   | -21846 |  0  |   45  |  21845 |
| 79   | -21846 |  0  |   53  |  21845 |
| 79   | -21846 |  0  |   61  | -21846 |
| 79+  |  21845 |  1  |   61  | -21846 |
| 80   |  21845 |  1  |   61  |  21845 |
| 80+  |  21845 |  0  |    5  |  21845 |
| 81   |  21845 |  0  |    5  |  21845 |
| 81   |  21845 |  0  |   13  |  21845 |
| 81   |  21845 |  0  |   21  |  21845 |
| 81   |  21845 |  0  |   29  |  21845 |
| 81   |  21845 |  0  |   37  |  21845 |
| 81   |  21845 |  0  |   45  |  21845 |
| 81   |  21845 |  0  |   53  |  21845 |
| 81   |  21845 |  0  |   61  |  21845 |
`);

export const RAM512 = new ChipDef(`
CHIP RAM512 {
  IN load, address[9], in[16];
  OUT out[16];
  
  PARTS:
  DMux8Way(sel=address[0..2], in=load, a=la, b=lb, c=lc, d=ld, e=le, f=lf, g=lg, h=lh);
  RAM64(in=in, load=la, address=address[3..8], out=a);
  RAM64(in=in, load=lb, address=address[3..8], out=b);
  RAM64(in=in, load=lc, address=address[3..8], out=c);
  RAM64(in=in, load=ld, address=address[3..8], out=d);
  RAM64(in=in, load=le, address=address[3..8], out=e);
  RAM64(in=in, load=lf, address=address[3..8], out=f);
  RAM64(in=in, load=lg, address=address[3..8], out=g);
  RAM64(in=in, load=lh, address=address[3..8], out=h);
  Mux8Way16(sel=address[0..2], a=a, b=b, c=c, d=d, e=e, f=f, g=g, h=h, out=out);
}
`);

export const RAM4K = new ChipDef(`
CHIP RAM4K {
  IN load, address[12], in[16];
  OUT out[16];
  
  PARTS:
  DMux8Way(sel=address[0..2], in=load, a=la, b=lb, c=lc, d=ld, e=le, f=lf, g=lg, h=lh);
  RAM512(in=in, load=la, address=address[3..11], out=a);
  RAM512(in=in, load=lb, address=address[3..11], out=b);
  RAM512(in=in, load=lc, address=address[3..11], out=c);
  RAM512(in=in, load=ld, address=address[3..11], out=d);
  RAM512(in=in, load=le, address=address[3..11], out=e);
  RAM512(in=in, load=lf, address=address[3..11], out=f);
  RAM512(in=in, load=lg, address=address[3..11], out=g);
  RAM512(in=in, load=lh, address=address[3..11], out=h);
  Mux8Way16(sel=address[0..2], a=a, b=b, c=c, d=d, e=e, f=f, g=g, h=h, out=out);
}
`);

export const RAM16K = new ChipDef(`
CHIP RAM16K {
  IN load, address[14], in[16];
  OUT out[16];
  
  PARTS:
  DMux4Way(sel=address[0..1], in=load, a=la, b=lb, c=lc, d=ld);
  RAM4K(in=in, load=la, address=address[2..13], out=a);
  RAM4K(in=in, load=lb, address=address[2..13], out=b);
  RAM4K(in=in, load=lc, address=address[2..13], out=c);
  RAM4K(in=in, load=ld, address=address[2..13], out=d);
  Mux4Way16(sel=address[0..1], a=a, b=b, c=c, d=d, out=out);
}
`);

*/

export const PC = new ChipDef(`
CHIP PC {
  IN load, inc, reset, in[16];
  OUT out[16];

  PARTS:
  Or(a=load, b=inc, out=l1);
  Or(a=l1, b=reset, out=l2);
  Inc16(in=out, out=add);
  Mux16(sel=inc, a=out, b=add, out=x);
  Mux16(sel=load, a=x, b=in, out=y);
  Mux16(sel=reset, a=y, b=0, out=z);
  Register(in=z, load=l2, out=out);
}
`).test(`
| time |   in   |reset|load | inc |  out   |
| 0+   |      0 |  0  |  0  |  0  |      0 |
| 1    |      0 |  0  |  0  |  0  |      0 |
| 1+   |      0 |  0  |  0  |  1  |      0 |
| 2    |      0 |  0  |  0  |  1  |      1 |
| 2+   | -32123 |  0  |  0  |  1  |      1 |
| 3    | -32123 |  0  |  0  |  1  |      2 |
| 3+   | -32123 |  0  |  1  |  1  |      2 |
| 4    | -32123 |  0  |  1  |  1  | -32123 |
| 4+   | -32123 |  0  |  0  |  1  | -32123 |
| 5    | -32123 |  0  |  0  |  1  | -32122 |
| 5+   | -32123 |  0  |  0  |  1  | -32122 |
| 6    | -32123 |  0  |  0  |  1  | -32121 |
| 6+   |  12345 |  0  |  1  |  0  | -32121 |
| 7    |  12345 |  0  |  1  |  0  |  12345 |
| 7+   |  12345 |  1  |  1  |  0  |  12345 |
| 8    |  12345 |  1  |  1  |  0  |      0 |
| 8+   |  12345 |  0  |  1  |  1  |      0 |
| 9    |  12345 |  0  |  1  |  1  |  12345 |
| 9+   |  12345 |  1  |  1  |  1  |  12345 |
| 10   |  12345 |  1  |  1  |  1  |      0 |
| 10+  |  12345 |  0  |  0  |  1  |      0 |
| 11   |  12345 |  0  |  0  |  1  |      1 |
| 11+  |  12345 |  1  |  0  |  1  |      1 |
| 12   |  12345 |  1  |  0  |  1  |      0 |
| 12+  |      0 |  0  |  1  |  1  |      0 |
| 13   |      0 |  0  |  1  |  1  |      0 |
| 13+  |      0 |  0  |  0  |  1  |      0 |
| 14   |      0 |  0  |  0  |  1  |      1 |
| 14+  |  22222 |  1  |  0  |  0  |      1 |
| 15   |  22222 |  1  |  0  |  0  |      0 |
`)
